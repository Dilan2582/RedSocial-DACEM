<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DACEM – Feed</title>

  <!-- Fuente -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome Iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Pre-aplica el tema para evitar FOUC -->
  <script>
    (function(){
      var saved = localStorage.getItem('theme');
      if(!saved){ saved = matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }
      document.documentElement.setAttribute('data-theme', saved);
    })();
  </script>

  <style>
    /* ====== INSTAGRAM-LIKE TOKENS ====== */
    :root{
      --bg:#fafafa; --panel:#ffffff; --card:#ffffff;
      --line:rgba(0,0,0,.1);
      --text:#000000; --muted:#65676b;
      --primary:#0095f6; --accent:#fd1d1d;
      --shadow:0 1px 3px rgba(0,0,0,.12);
      --radius:8px;
    }

    [data-theme="dark"]{
      --bg:#000000; --panel:#262626; --card:#262626;
      --line:rgba(255,255,255,.15);
      --text:#ffffff; --muted:#a8a8a8;
      --primary:#0095f6; --accent:#fd1d1d;
      --shadow:0 1px 3px rgba(0,0,0,.5);
    }

    html,body{height:100%;margin:0}
    body{
      background:var(--bg);
      color:var(--text);
      font-family:'Segoe UI',system-ui,Roboto,Arial;
      overflow-x:hidden
    }

    /* ====== TOPBAR ====== */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      background:var(--panel);
      border-bottom:1px solid var(--line);
      padding:0;
    }

    .topbar-inner{
      max-width:1200px;
      margin:0 auto;
      padding:12px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:700;
      font-size:1.3rem;
      letter-spacing:-.5px;
    }

    .brand i{
      font-size:1.5rem;
      background:linear-gradient(45deg, #feda75, #fa7e1e, #d92e7f, #9b36b7, #515bd4);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }

    .topbar-actions{
      display:flex;
      gap:10px;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:none;
      background:var(--panel);
      color:var(--text);
      padding:8px 16px;
      border-radius:20px;
      font-weight:600;
      cursor:pointer;
      transition:.2s ease;
      font-size:.9rem;
      display:flex;
      align-items:center;
      gap:6px;
    }

    .btn:hover{
      background:var(--muted);
      opacity:.7;
    }

    .btn.danger{
      background:#ff4458;
      color:white;
    }

    .btn.danger:hover{
      background:#e63946;
      opacity:1;
    }

    .btn.primary{
      background:var(--primary);
      color:white;
    }

    .btn.primary:hover{
      opacity:.8;
    }

    /* ====== MAIN LAYOUT ====== */
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:0;
    }

    .layout{
      display:grid;
      grid-template-columns:240px 1fr 280px;
      gap:0;
      min-height:calc(100vh - 60px);
    }

    /* ====== SIDEBAR ====== */
    .sidebar{
      position:sticky;
      top:60px;
      height:fit-content;
      border-right:1px solid var(--line);
      padding:20px;
      background:var(--panel);
    }

    .nav{
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .nav-item{
      display:flex;
      gap:12px;
      align-items:center;
      padding:12px 16px;
      border-radius:20px;
      color:var(--text);
      text-decoration:none;
      transition:.2s ease;
      font-weight:500;
    }

    .nav-item:hover,
    .nav-item.active{
      background:var(--line);
    }

    .nav-item i{
      font-size:1.3rem;
      width:24px;
    }

    /* ====== MAIN CONTENT ====== */
    .main{
      border-right:1px solid var(--line);
      border-left:1px solid var(--line);
      padding:0;
      min-height:calc(100vh - 60px);
    }

    .card{
      background:var(--card);
      border-bottom:1px solid var(--line);
      box-shadow:var(--shadow);
    }

    /* ====== COMPOSER ====== */
    .composer{
      padding:20px;
      display:grid;
      gap:16px;
      border-bottom:1px solid var(--line);
    }

    .cmp-row{
      display:flex;
      gap:12px;
    }

    .cmp-avatar{
      width:40px;
      height:40px;
      border-radius:50%;
      flex-shrink:0;
    }

    .cmp-input{
      flex:1;
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:20px;
      color:var(--text);
      padding:12px 16px;
      font-family:inherit;
      font-size:.95rem;
      outline:none;
      resize:none;
      transition:.2s ease;
    }

    .cmp-input:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(0,149,246,.1);
    }

    .cmp-input::placeholder{
      color:var(--muted);
    }

    .cmp-preview{
      display:flex;
      gap:10px;
      align-items:center;
      padding:12px;
      background:var(--bg);
      border-radius:8px;
    }

    .cmp-preview img{
      max-height:120px;
      border-radius:6px;
      object-fit:cover;
    }

    .cmp-tools{
      display:flex;
      align-items:center;
      gap:8px;
      justify-content:space-between;
    }

    .cmp-tools .spacer{
      flex:1;
    }

    .cmp-msg{
      font-size:.9rem;
      color:var(--muted);
      text-align:center;
      min-height:20px;
    }

    /* ====== FEED ====== */
    .feed{
      display:grid;
      gap:0;
    }

    .post-card{
      background:var(--card);
      border-bottom:1px solid var(--line);
      overflow:hidden;
      transition:.2s ease;
    }

    .post-card:hover{
      background:var(--panel);
    }

    .post-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 16px;
      border-bottom:1px solid var(--line);
    }

    .post-ava{
      width:36px;
      height:36px;
      border-radius:50%;
      object-fit:cover;
    }

    .post-user{
      display:grid;
      line-height:1.2;
      flex:1;
    }

    .post-name{
      font-weight:700;
      color:var(--text);
      text-decoration:none;
    }

    .post-name:hover{
      text-decoration:underline;
    }

    .post-userid{
      color:var(--muted);
      font-size:.85rem;
    }

    .post-media{
      background:var(--bg);
      border-bottom:1px solid var(--line);
    }

    .post-media img{
      display:block;
      width:100%;
      height:auto;
      object-fit:cover;
      max-height:600px;
      cursor:pointer;
    }

    .post-caption{
      padding:12px 16px 0;
      font-size:.95rem;
      line-height:1.5;
    }

    .post-actions{
      display:flex;
      gap:16px;
      padding:8px 16px;
      border-top:1px solid var(--line);
    }

    .btn-icon{
      background:none;
      border:none;
      color:var(--muted);
      cursor:pointer;
      padding:8px 12px;
      font-size:1rem;
      transition:.2s ease;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .btn-icon:hover{
      color:var(--primary);
    }

    .btn-icon[aria-pressed="true"]{
      color:var(--accent);
    }

    .post-counts{
      color:var(--muted);
      font-size:.85rem;
      margin:8px 16px;
    }

    .post-counts strong{
      color:var(--text);
      font-weight:700;
    }

    /* ====== LOAD MORE ====== */
    .load-more{
      padding:20px;
      text-align:center;
    }

    /* ====== RIGHT SIDEBAR ====== */
    .aside{
      position:sticky;
      top:60px;
      height:fit-content;
      padding:20px;
      background:var(--panel);
      border-left:1px solid var(--line);
    }

    .aside h3{
      margin:0 0 16px;
      font-size:1.1rem;
      font-weight:700;
    }

    .people-list{
      display:grid;
      gap:12px;
    }

    .person-row{
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px;
      background:var(--bg);
      border-radius:var(--radius);
      transition:.2s ease;
    }

    .person-row:hover{
      background:var(--line);
    }

    .p-avatar img{
      width:36px;
      height:36px;
      border-radius:50%;
      object-fit:cover;
    }

    .p-info{
      flex:1;
      min-width:0;
    }

    .p-name{
      font-weight:700;
      font-size:.9rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .p-user{
      color:var(--muted);
      font-size:.8rem;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .p-actions{
      margin-left:auto;
      display:flex;
      gap:6px;
    }

    .p-actions .btn{
      padding:6px 12px;
      font-size:.85rem;
    }

    /* ====== LIGHTBOX ====== */
    .lightbox{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,.7);
      z-index:100;
    }

    .lightbox[aria-hidden="false"]{
      display:flex;
    }

    .lb-content{
      display:grid;
      grid-template-columns:min(60vw,600px) 360px;
      gap:0;
      background:var(--card);
      border-radius:8px;
      max-height:90vh;
      overflow:hidden;
    }

    @media (max-width:1080px){
      .lb-content{grid-template-columns:1fr}
      .lb-side{grid-template-rows:auto 1fr auto}
    }

    .lb-close{
      position:absolute;
      right:12px;
      top:12px;
      background:rgba(0,0,0,.5);
      border:none;
      color:white;
      width:36px;
      height:36px;
      border-radius:50%;
      cursor:pointer;
      font-size:1.2rem;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:101;
    }

    .lb-media{
      background:var(--bg);
      border-bottom:1px solid var(--line);
      overflow:hidden;
    }

    .lb-media img{
      display:block;
      width:100%;
      height:100%;
      object-fit:cover;
    }

    .lb-side{
      display:grid;
      grid-template-rows:auto 1fr auto;
    }

    .lb-head{
      display:flex;
      gap:10px;
      align-items:center;
      padding:12px 14px;
      border-bottom:1px solid var(--line);
    }

    .lb-ava{
      width:36px;
      height:36px;
      border-radius:50%;
      object-fit:cover;
    }

    .lb-body{
      padding:12px 14px;
      overflow-y:auto;
      max-height:50vh;
    }

    .lb-cmt{
      display:flex;
      gap:8px;
      margin-bottom:8px;
      font-size:.9rem;
    }

    .lb-cmt .nm{
      font-weight:700;
      flex-shrink:0;
    }

    .lb-cmt .dt{
      color:var(--muted);
      font-size:.8rem;
      flex-shrink:0;
    }

    .lb-input{
      display:flex;
      gap:8px;
      padding:12px 14px;
      border-top:1px solid var(--line);
    }

    .lb-input input{
      flex:1;
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:20px;
      color:var(--text);
      padding:8px 16px;
      font-family:inherit;
      outline:none;
    }

    .lb-input input:focus{
      border-color:var(--primary);
    }

    .lb-input .btn{
      padding:8px 16px;
    }

    /* ====== RESPONSIVE ====== */
    @media (max-width:1080px){
      .layout{
        grid-template-columns:1fr;
      }
      .sidebar{
        display:none;
      }
      .aside{
        display:none;
      }
      .main{
        border-right:none;
        border-left:none;
      }
    }

    @media (max-width:600px){
      .topbar-inner{
        padding:12px 16px;
      }
      .composer{
        padding:16px;
      }
      .post-head,
      .post-actions,
      .post-caption{
        padding-left:12px;
        padding-right:12px;
      }
      .lb-content{
        grid-template-columns:1fr;
      }
    }

    /* ====== SCROLLBAR ====== */
    ::-webkit-scrollbar{
      width:8px;
    }

    ::-webkit-scrollbar-track{
      background:transparent;
    }

    ::-webkit-scrollbar-thumb{
      background:var(--line);
      border-radius:4px;
    }

    ::-webkit-scrollbar-thumb:hover{
      background:var(--muted);
    }
  </style>
</head>
<body>

  <!-- Google Fonts -->

  <link rel="preconnect" href="https://fonts.googleapis.com">  <meta name="viewport" content="width=device-width,initial-scale=1"/>  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">  <title>DACEM – Feed</title>  <title>DACEM – Feed</title>

  

  <!-- Font Awesome -->

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Fuente -->  <!-- Fuente -->

  <script>

    (function(){  <link rel="preconnect" href="https://fonts.googleapis.com">  <link rel="preconnect" href="https://fonts.googleapis.com">

      let saved = localStorage.getItem('theme');

      if (!saved) { saved = matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

      document.documentElement.setAttribute('data-theme', saved);

    })();  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap" rel="stylesheet">

  </script>

  

  <style>

    :root {  <!-- Font Awesome Iconos -->  <!-- Font Awesome Iconos -->

      --bg: #fafafa;

      --panel: #ffffff;  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

      --card: #ffffff;

      --line: rgba(0, 0, 0, 0.1);

      --text: #000000;

      --muted: #65676b;  <!-- Pre-aplica el tema para evitar FOUC -->  <!-- Pre-aplica el tema para evitar FOUC -->

      --primary: #0095f6;

      --accent: #fd1d1d;  <script>  <script>

      --shadow: 0 1px 3px rgba(0, 0, 0, 0.12);

      --radius: 8px;    (function(){    (function(){

    }

          var saved = localStorage.getItem('theme');      var saved = localStorage.getItem('theme');

    [data-theme="dark"] {

      --bg: #000000;      if(!saved){ saved = matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }      if(!saved){ saved = matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }

      --panel: #262626;

      --card: #262626;      document.documentElement.setAttribute('data-theme', saved);      document.documentElement.setAttribute('data-theme', saved);

      --line: rgba(255, 255, 255, 0.15);

      --text: #ffffff;    })();    })();

      --muted: #a8a8a8;

      --primary: #0095f6;  </script>  </script>

      --accent: #fd1d1d;

      --shadow: 0 1px 3px rgba(0, 0, 0, 0.5);

    }

      <style>  <style>

    * { box-sizing: border-box; }

    html, body { height: 100%; margin: 0; }    /* ====== INSTAGRAM-LIKE TOKENS ====== */    /* ====== INSTAGRAM-LIKE TOKENS ====== */

    body {

      background: var(--bg);    :root{    :root{

      color: var(--text);

      font-family: 'Segoe UI', system-ui, Roboto, Arial, sans-serif;      --bg:#fafafa; --panel:#ffffff; --card:#ffffff;      --bg:#fafafa; --panel:#ffffff; --card:#ffffff;

      overflow-x: hidden;

    }      --line:rgba(0,0,0,.1);      --line:rgba(0,0,0,.1);

    

    /* TOPBAR */      --text:#000000; --muted:#65676b;      --text:#000000; --muted:#65676b;

    .topbar {

      position: sticky;      --primary:#0095f6; --accent:#fd1d1d;      --primary:#0095f6; --accent:#fd1d1d;

      top: 0;

      z-index: 50;      --shadow:0 1px 3px rgba(0,0,0,.12);      --shadow:0 1px 3px rgba(0,0,0,.12);

      background: var(--panel);

      border-bottom: 1px solid var(--line);      --radius:8px;      --radius:8px;

      padding: 0;

    }    }    }

    

    .topbar-inner {

      max-width: 1200px;

      margin: 0 auto;    [data-theme="dark"]{    [data-theme="dark"]{

      padding: 12px 20px;

      display: flex;      --bg:#000000; --panel:#262626; --card:#262626;      --bg:#000000; --panel:#262626; --card:#262626;

      align-items: center;

      justify-content: space-between;      --line:rgba(255,255,255,.15);      --line:rgba(255,255,255,.15);

    }

          --text:#ffffff; --muted:#a8a8a8;      --text:#ffffff; --muted:#a8a8a8;

    .brand {

      display: flex;      --primary:#0095f6; --accent:#fd1d1d;      --primary:#0095f6; --accent:#fd1d1d;

      align-items: center;

      gap: 10px;      --shadow:0 1px 3px rgba(0,0,0,.5);      --shadow:0 1px 3px rgba(0,0,0,.5);

      font-weight: 700;

      font-size: 1.3rem;    }    }

      letter-spacing: -0.5px;

    }

    

    .brand i {    html,body{height:100%;margin:0}    html,body{height:100%;margin:0}

      font-size: 1.5rem;

      background: linear-gradient(45deg, #feda75, #fa7e1e, #d92e7f, #9b36b7, #515bd4);    body{    body{

      -webkit-background-clip: text;

      -webkit-text-fill-color: transparent;      background:var(--bg);      background:var(--bg);

      background-clip: text;

    }      color:var(--text);      color:var(--text);

    

    .topbar-actions {      font-family:'Segoe UI',system-ui,Roboto,Arial;      font-family:'Segoe UI',system-ui,Roboto,Arial;

      display: flex;

      gap: 10px;      overflow-x:hidden      overflow-x:hidden

      align-items: center;

    }    }    }

    

    .btn {

      appearance: none;

      border: none;    /* ====== TOPBAR ====== */    /* ====== TOPBAR ====== */

      background: var(--panel);

      color: var(--text);    .topbar{    .topbar{

      padding: 8px 16px;

      border-radius: 20px;      position:sticky;      position:sticky;

      font-weight: 600;

      cursor: pointer;      top:0;      top:0;

      transition: 0.2s ease;

      font-size: 0.9rem;      z-index:50;      z-index:50;

      display: flex;

      align-items: center;      background:var(--panel);      background:var(--panel);

      gap: 6px;

    }      border-bottom:1px solid var(--line);      border-bottom:1px solid var(--line);

    

    .btn:hover { background: var(--muted); opacity: 0.7; }      padding:0;      padding:0;

    

    .btn.danger {    }    }

      background: #ff4458;

      color: white;

    }

        .topbar-inner{    .topbar-inner{

    .btn.danger:hover { background: #e63946; opacity: 1; }

          max-width:1200px;      max-width:1200px;

    .btn.primary {

      background: var(--primary);      margin:0 auto;      margin:0 auto;

      color: white;

    }      padding:12px 20px;      padding:12px 20px;

    

    .btn.primary:hover { opacity: 0.8; }      display:flex;      display:flex;

    

    /* MAIN LAYOUT */      align-items:center;      align-items:center;

    .wrap {

      max-width: 1200px;      justify-content:space-between;      justify-content:space-between;

      margin: 0 auto;

      padding: 0;    }    }

    }

    

    .layout {

      display: grid;    .brand{    .brand{

      grid-template-columns: 240px 1fr 280px;

      gap: 0;      display:flex;      display:flex;

      min-height: calc(100vh - 60px);

    }      align-items:center;      align-items:center;

    

    /* SIDEBAR */      gap:10px;      gap:10px;

    .sidebar {

      position: sticky;      font-weight:700;      font-weight:700;

      top: 60px;

      height: fit-content;      font-size:1.3rem;      font-size:1.3rem;

      border-right: 1px solid var(--line);

      padding: 20px;      letter-spacing:-.5px;      letter-spacing:-.5px;

      background: var(--panel);

    }    }    }

    

    .nav {

      display: flex;

      flex-direction: column;    .brand i{    .brand i{

      gap: 12px;

    }      font-size:1.5rem;      font-size:1.5rem;

    

    .nav-item {      background:linear-gradient(45deg, #feda75, #fa7e1e, #d92e7f, #9b36b7, #515bd4);      background:linear-gradient(45deg, #feda75, #fa7e1e, #d92e7f, #9b36b7, #515bd4);

      display: flex;

      gap: 12px;      -webkit-background-clip:text;      -webkit-background-clip:text;

      align-items: center;

      padding: 12px 16px;      -webkit-text-fill-color:transparent;      -webkit-text-fill-color:transparent;

      border-radius: 20px;

      color: var(--text);      background-clip:text;      background-clip:text;

      text-decoration: none;

      transition: 0.2s ease;    }    }

      font-weight: 500;

    }

    

    .nav-item:hover, .nav-item.active { background: var(--line); }    .topbar-actions{    .topbar-actions{

    

    .nav-item i { font-size: 1.3rem; width: 24px; }      display:flex;      display:flex;

    

    /* MAIN CONTENT */      gap:10px;      gap:10px;

    .main {

      border-right: 1px solid var(--line);      align-items:center;      align-items:center;

      border-left: 1px solid var(--line);

      padding: 0;    }    }

      min-height: calc(100vh - 60px);

    }

    

    .card {    .btn{    .btn{

      background: var(--card);

      border-bottom: 1px solid var(--line);      appearance:none;      appearance:none;

      box-shadow: var(--shadow);

    }      border:none;      border:none;

    

    /* COMPOSER */      background:var(--panel);      background:var(--panel);

    .composer {

      padding: 20px;      color:var(--text);      color:var(--text);

      display: grid;

      gap: 16px;      padding:8px 16px;      padding:8px 16px;

      border-bottom: 1px solid var(--line);

    }      border-radius:20px;      border-radius:20px;

    

    .cmp-row {      font-weight:600;      font-weight:600;

      display: flex;

      gap: 12px;      cursor:pointer;      cursor:pointer;

    }

          transition:.2s ease;      transition:.2s ease;

    .cmp-avatar {

      width: 40px;      font-size:.9rem;      font-size:.9rem;

      height: 40px;

      border-radius: 50%;      display:flex;      display:flex;

      flex-shrink: 0;

    }      align-items:center;      align-items:center;

    

    .cmp-input {      gap:6px;      gap:6px;

      flex: 1;

      background: var(--bg);    }    }

      border: 1px solid var(--line);

      border-radius: 20px;

      color: var(--text);

      padding: 12px 16px;    .btn:hover{    .btn:hover{

      font-family: inherit;

      font-size: 0.95rem;      background:var(--muted);      background:var(--muted);

      outline: none;

      resize: none;      opacity:.7;      opacity:.7;

      transition: 0.2s ease;

    }    }    }

    

    .cmp-input:focus {

      border-color: var(--primary);

      box-shadow: 0 0 0 3px rgba(0, 149, 246, 0.1);    .btn.danger{    .btn.danger{

    }

          background:#ff4458;      background:#ff4458;

    .cmp-input::placeholder { color: var(--muted); }

          color:white;      color:white;

    .cmp-preview {

      display: flex;    }    }

      gap: 10px;

      align-items: center;

      padding: 12px;

      background: var(--bg);    .btn.danger:hover{    .btn.danger:hover{

      border-radius: 8px;

    }      background:#e63946;      background:#e63946;

    

    .cmp-preview img {      opacity:1;      opacity:1;

      max-height: 120px;

      border-radius: 6px;    }    }

      object-fit: cover;

    }

    

    .cmp-tools {    .btn.primary{    .btn.primary{

      display: flex;

      align-items: center;      background:var(--primary);      background:var(--primary);

      gap: 8px;

      justify-content: space-between;      color:white;      color:white;

    }

        }    }

    .cmp-tools .spacer { flex: 1; }

    

    .cmp-msg {

      font-size: 0.9rem;    .btn.primary:hover{    .btn.primary:hover{

      color: var(--muted);

      text-align: center;      opacity:.8;      opacity:.8;

      min-height: 20px;

    }    }    }

    

    /* FEED */

    .feed { display: grid; gap: 0; }

        /* ====== MAIN LAYOUT ====== */    /* ====== MAIN LAYOUT ====== */

    .post-card {

      background: var(--card);    .wrap{    .wrap{

      border-bottom: 1px solid var(--line);

      overflow: hidden;      max-width:1200px;      max-width:1200px;

      transition: 0.2s ease;

    }      margin:0 auto;      margin:0 auto;

    

    .post-card:hover { background: var(--panel); }      padding:0;      padding:0;

    

    .post-head {    }    }

      display: flex;

      align-items: center;

      justify-content: space-between;

      gap: 12px;    .layout{    .layout{

      padding: 12px 16px;

      border-bottom: 1px solid var(--line);      display:grid;      display:grid;

    }

          grid-template-columns:240px 1fr 280px;      grid-template-columns:240px 1fr 280px;

    .post-ava {

      width: 36px;      gap:0;      gap:0;

      height: 36px;

      border-radius: 50%;      min-height:calc(100vh - 60px);      min-height:calc(100vh - 60px);

      object-fit: cover;

    }    }    }

    

    .post-user {

      display: grid;

      line-height: 1.2;    /* ====== SIDEBAR ====== */    /* ====== SIDEBAR ====== */

      flex: 1;

    }    .sidebar{    .sidebar{

    

    .post-name {      position:sticky;      position:sticky;

      font-weight: 700;

      color: var(--text);      top:60px;      top:60px;

      text-decoration: none;

    }      height:fit-content;      height:fit-content;

    

    .post-name:hover { text-decoration: underline; }      border-right:1px solid var(--line);      border-right:1px solid var(--line);

    

    .post-userid {      padding:20px;      padding:20px;

      color: var(--muted);

      font-size: 0.85rem;      background:var(--panel);      background:var(--panel);

    }

        }    }

    .post-media {

      background: var(--bg);

      border-bottom: 1px solid var(--line);

    }    .nav{    .nav{

    

    .post-media img {      display:flex;      display:flex;

      display: block;

      width: 100%;      flex-direction:column;      flex-direction:column;

      height: auto;

      object-fit: cover;      gap:12px;      gap:12px;

      max-height: 600px;

      cursor: pointer;    }    }

    }

    

    .post-caption {

      padding: 12px 16px 0;    .nav-item{    .nav-item{

      font-size: 0.95rem;

      line-height: 1.5;      display:flex;      display:flex;

    }

          gap:12px;      gap:12px;

    .post-actions {

      display: flex;      align-items:center;      align-items:center;

      gap: 16px;

      padding: 8px 16px;      padding:12px 16px;      padding:12px 16px;

      border-top: 1px solid var(--line);

    }      border-radius:20px;      border-radius:20px;

    

    .btn-icon {      color:var(--text);      color:var(--text);

      background: none;

      border: none;      text-decoration:none;      text-decoration:none;

      color: var(--muted);

      cursor: pointer;      transition:.2s ease;      transition:.2s ease;

      padding: 8px 12px;

      font-size: 1rem;      font-weight:500;      font-weight:500;

      transition: 0.2s ease;

      display: flex;    }    }

      align-items: center;

      gap: 8px;

    }

        .nav-item:hover,    .nav-item:hover,

    .btn-icon:hover { color: var(--primary); }

        .nav-item.active{    .nav-item.active{

    .btn-icon[aria-pressed="true"] { color: var(--accent); }

          background:var(--line);      background:var(--line);

    .post-counts {

      color: var(--muted);    }    }

      font-size: 0.85rem;

      margin: 8px 16px;

    }

        .nav-item i{    .nav-item i{

    .post-counts strong {

      color: var(--text);      font-size:1.3rem;      font-size:1.3rem;

      font-weight: 700;

    }      width:24px;      width:24px;

    

    /* LOAD MORE */    }    }

    .load-more {

      padding: 20px;

      text-align: center;

    }    /* ====== MAIN CONTENT ====== */    /* ====== MAIN CONTENT ====== */

    

    /* RIGHT SIDEBAR */    .main{    .main{

    .aside {

      position: sticky;      border-right:1px solid var(--line);      border-right:1px solid var(--line);

      top: 60px;

      height: fit-content;      border-left:1px solid var(--line);      border-left:1px solid var(--line);

      padding: 20px;

      background: var(--panel);      padding:0;      padding:0;

      border-left: 1px solid var(--line);

    }      min-height:calc(100vh - 60px);      min-height:calc(100vh - 60px);

    

    .aside h3 {    }    }

      margin: 0 0 16px;

      font-size: 1.1rem;

      font-weight: 700;

    }    .card{    .card{

    

    .people-list { display: grid; gap: 12px; }      background:var(--card);      background:var(--card);

    

    .person-row {      border-bottom:1px solid var(--line);      border-bottom:1px solid var(--line);

      display: flex;

      gap: 10px;      box-shadow:var(--shadow);      box-shadow:var(--shadow);

      align-items: center;

      padding: 10px;    }    }

      background: var(--bg);

      border-radius: var(--radius);

      transition: 0.2s ease;

    }    /* ====== COMPOSER ====== */    /* ====== COMPOSER ====== */

    

    .person-row:hover { background: var(--line); }    .composer{    .composer{

    

    .p-avatar img {      padding:20px;      padding:20px;

      width: 36px;

      height: 36px;      display:grid;      display:grid;

      border-radius: 50%;

      object-fit: cover;      gap:16px;      gap:16px;

    }

          border-bottom:1px solid var(--line);      border-bottom:1px solid var(--line);

    .p-info {

      flex: 1;    }    }

      min-width: 0;

    }

    

    .p-name {    .cmp-row{    .cmp-row{

      font-weight: 700;

      font-size: 0.9rem;      display:flex;      display:flex;

      white-space: nowrap;

      overflow: hidden;      gap:12px;      gap:12px;

      text-overflow: ellipsis;

    }    }    }

    

    .p-user {

      color: var(--muted);

      font-size: 0.8rem;    .cmp-avatar{    .cmp-avatar{

      white-space: nowrap;

      overflow: hidden;      width:40px;      width:40px;

      text-overflow: ellipsis;

    }      height:40px;      height:40px;

    

    .p-actions {      border-radius:50%;      border-radius:50%;

      margin-left: auto;

      display: flex;      flex-shrink:0;      flex-shrink:0;

      gap: 6px;

    }    }    }

    

    .p-actions .btn { padding: 6px 12px; font-size: 0.85rem; }

    

    /* LIGHTBOX */    .cmp-input{    .cmp-input{

    .lightbox {

      position: fixed;      flex:1;      flex:1;

      inset: 0;

      display: none;      background:var(--bg);      background:var(--bg);

      align-items: center;

      justify-content: center;      border:1px solid var(--line);      border:1px solid var(--line);

      background: rgba(0, 0, 0, 0.7);

      z-index: 100;      border-radius:20px;      border-radius:20px;

    }

          color:var(--text);      color:var(--text);

    .lightbox[aria-hidden="false"] { display: flex; }

          padding:12px 16px;      padding:12px 16px;

    .lb-content {

      display: grid;      font-family:inherit;      font-family:inherit;

      grid-template-columns: min(60vw, 600px) 360px;

      gap: 0;      font-size:.95rem;      font-size:.95rem;

      background: var(--card);

      border-radius: 8px;      outline:none;      outline:none;

      max-height: 90vh;

      overflow: hidden;      resize:none;      resize:none;

    }

          transition:.2s ease;      transition:.2s ease;

    @media (max-width: 1080px) {

      .lb-content { grid-template-columns: 1fr; }    }    }

      .lb-side { grid-template-rows: auto 1fr auto; }

    }

    

    .lb-close {    .cmp-input:focus{    .cmp-input:focus{

      position: absolute;

      right: 12px;      border-color:var(--primary);      border-color:var(--primary);

      top: 12px;

      background: rgba(0, 0, 0, 0.5);      box-shadow:0 0 0 3px rgba(0,149,246,.1);      box-shadow:0 0 0 3px rgba(0,149,246,.1);

      border: none;

      color: white;    }    }

      width: 36px;

      height: 36px;

      border-radius: 50%;

      cursor: pointer;    .cmp-input::placeholder{    .cmp-input::placeholder{

      font-size: 1.2rem;

      display: flex;      color:var(--muted);      color:var(--muted);

      align-items: center;

      justify-content: center;    }    }

      z-index: 101;

    }

    

    .lb-media {    .cmp-preview{    .cmp-preview{

      background: var(--bg);

      border-bottom: 1px solid var(--line);      display:flex;      display:flex;

      overflow: hidden;

    }      gap:10px;      gap:10px;

    

    .lb-media img {      align-items:center;      align-items:center;

      display: block;

      width: 100%;      padding:12px;      padding:12px;

      height: 100%;

      object-fit: cover;      background:var(--bg);      background:var(--bg);

    }

          border-radius:8px;      border-radius:8px;

    .lb-side { display: grid; grid-template-rows: auto 1fr auto; }

        }    }

    .lb-head {

      display: flex;

      gap: 10px;

      align-items: center;    .cmp-preview img{    .cmp-preview img{

      padding: 12px 14px;

      border-bottom: 1px solid var(--line);      max-height:120px;      max-height:120px;

    }

          border-radius:6px;      border-radius:6px;

    .lb-ava {

      width: 36px;      object-fit:cover;      object-fit:cover;

      height: 36px;

      border-radius: 50%;    }    }

      object-fit: cover;

    }

    

    .lb-body {    .cmp-tools{    .cmp-tools{

      padding: 12px 14px;

      overflow-y: auto;      display:flex;      display:flex;

      max-height: 50vh;

    }      align-items:center;      align-items:center;

    

    .lb-cmt {      gap:8px;      gap:8px;

      display: flex;

      gap: 8px;      justify-content:space-between;      justify-content:space-between;

      margin-bottom: 8px;

      font-size: 0.9rem;    }    }

    }

    

    .lb-cmt .nm { font-weight: 700; flex-shrink: 0; }

    .lb-cmt .dt { color: var(--muted); font-size: 0.8rem; flex-shrink: 0; }    .cmp-tools .spacer{    .cmp-tools .spacer{

    

    .lb-input {      flex:1;      flex:1;

      display: flex;

      gap: 8px;    }    }

      padding: 12px 14px;

      border-top: 1px solid var(--line);

    }

        .cmp-msg{    .cmp-msg{

    .lb-input input {

      flex: 1;      font-size:.9rem;      font-size:.9rem;

      background: var(--bg);

      border: 1px solid var(--line);      color:var(--muted);      color:var(--muted);

      border-radius: 20px;

      color: var(--text);      text-align:center;      text-align:center;

      padding: 8px 16px;

      font-family: inherit;      min-height:20px;      min-height:20px;

      outline: none;

    }    }    }

    

    .lb-input input:focus { border-color: var(--primary); }

    

    .lb-input .btn { padding: 8px 16px; }    /* ====== FEED ====== */    /* ====== FEED ====== */

    

    /* RESPONSIVE */    .feed{    .feed{

    @media (max-width: 1080px) {

      .layout { grid-template-columns: 1fr; }      display:grid;      display:grid;

      .sidebar { display: none; }

      .aside { display: none; }      gap:0;      gap:0;

      .main { border-right: none; border-left: none; }

    }    }    }

    

    @media (max-width: 600px) {

      .topbar-inner { padding: 12px 16px; }

      .composer { padding: 16px; }    .post-card{    .post-card{

      .post-head, .post-actions, .post-caption { padding-left: 12px; padding-right: 12px; }

      .lb-content { grid-template-columns: 1fr; }      background:var(--card);      background:var(--card);

    }

          border-bottom:1px solid var(--line);      border-bottom:1px solid var(--line);

    /* SCROLLBAR */

    ::-webkit-scrollbar {      overflow:hidden;      overflow:hidden;

      width: 8px;

    }      transition:.2s ease;      transition:.2s ease;

    

    ::-webkit-scrollbar-track { background: transparent; }    }    }

    

    ::-webkit-scrollbar-thumb {

      background: var(--line);

      border-radius: 4px;    .post-card:hover{    .post-card:hover{

    }

          background:var(--panel);      background:var(--panel);

    ::-webkit-scrollbar-thumb:hover { background: var(--muted); }

  </style>    }    }

</head>

<body>

  <!-- TOPBAR -->

  <header class="topbar">    .post-head{    .post-head{

    <div class="topbar-inner">

      <div class="brand">      display:flex;      display:flex;

        <i class="fas fa-circle"></i> DACEM

      </div>      align-items:center;      align-items:center;

      <div class="topbar-actions">

        <button id="themeToggle" class="btn" title="Cambiar tema">      justify-content:space-between;      justify-content:space-between;

          <i class="fas fa-moon"></i> Modo oscuro

        </button>      gap:12px;      gap:12px;

        <button id="logoutBtnTop" class="btn danger">

          <i class="fas fa-sign-out-alt"></i> Cerrar sesión      padding:12px 16px;      padding:12px 16px;

        </button>

      </div>      border-bottom:1px solid var(--line);      border-bottom:1px solid var(--line);

    </div>

  </header>    }    }



  <div class="wrap">

    <div class="layout">

      <!-- LEFT SIDEBAR -->    .post-ava{    .post-ava{

      <aside class="sidebar">

        <nav class="nav">      width:36px;      width:36px;

          <a class="nav-item active" href="user.html">

            <i class="fas fa-home"></i> Inicio      height:36px;      height:36px;

          </a>

          <a class="nav-item" href="profile.html">      border-radius:50%;      border-radius:50%;

            <i class="fas fa-user"></i> Mi perfil

          </a>      object-fit:cover;      object-fit:cover;

        </nav>

      </aside>    }    }



      <!-- MAIN FEED -->

      <main class="main">

        <!-- COMPOSER -->    .post-user{    .post-user{

        <section class="card composer" id="composer">

          <div class="cmp-row">      display:grid;      display:grid;

            <img id="cmpAvatar" class="cmp-avatar" alt="avatar">

            <textarea id="cmpText" class="cmp-input" rows="2" placeholder="¿Qué estás pensando?"></textarea>      line-height:1.2;      line-height:1.2;

          </div>

          <div id="cmpPreview" class="cmp-preview" style="display: none;">      flex:1;      flex:1;

            <img id="cmpPreviewImg" alt="preview">

            <button id="cmpRemoveImg" class="btn">    }    }

              <i class="fas fa-times"></i> Quitar

            </button>

          </div>

          <div class="cmp-tools">    .post-name{    .post-name{

            <input id="cmpFile" type="file" accept="image/*" hidden>

            <button id="cmpPick" class="btn">      font-weight:700;      font-weight:700;

              <i class="fas fa-image"></i> Imagen

            </button>      color:var(--text);      color:var(--text);

            <div class="spacer"></div>

            <button id="cmpPost" class="btn primary">      text-decoration:none;      text-decoration:none;

              <i class="fas fa-paper-plane"></i> Publicar

            </button>    }    }

          </div>

          <div class="cmp-msg" id="cmpMsg"></div>

        </section>

    .post-name:hover{    .post-name:hover{

        <!-- FEED -->

        <section class="feed" id="feed"></section>      text-decoration:underline;      text-decoration:underline;

        <div class="load-more">

          <button id="btnMore" class="btn primary">    }    }

            <i class="fas fa-chevron-down"></i> Cargar más

          </button>

        </div>

      </main>    .post-userid{    .post-userid{



      <!-- RIGHT SIDEBAR -->      color:var(--muted);      color:var(--muted);

      <aside class="aside">

        <h3><i class="fas fa-users"></i> Personas</h3>      font-size:.85rem;      font-size:.85rem;

        <div id="peopleList" class="people-list"></div>

      </aside>    }    }

    </div>

  </div>



  <!-- LIGHTBOX -->    .post-media{    .post-media{

  <div class="lightbox" id="lightbox" aria-hidden="true">

    <button class="lb-close" id="lbClose"><i class="fas fa-times"></i></button>      background:var(--bg);      background:var(--bg);

    <div class="lb-content" role="dialog" aria-modal="true" aria-label="Publicación">

      <div class="lb-media"><img id="lbImg" alt=""></div>      border-bottom:1px solid var(--line);      border-bottom:1px solid var(--line);

      <aside class="lb-side">

        <header class="lb-head">    }    }

          <img id="lbAva" class="lb-ava" alt="">

          <div>

            <div id="lbName" style="font-weight: 700;"></div>

            <div id="lbUser" style="font-size: 12px; color: var(--muted);"></div>    .post-media img{    .post-media img{

          </div>

        </header>      display:block;      display:block;

        <div class="lb-body" id="lbComments"></div>

        <div class="lb-input">      width:100%;      width:100%;

          <input id="lbInp" placeholder="Añade un comentario…">

          <button id="lbSend" class="btn primary"><i class="fas fa-paper-plane"></i></button>      height:auto;      height:auto;

        </div>

      </aside>      object-fit:cover;      object-fit:cover;

    </div>

  </div>      max-height:600px;      max-height:600px;



  <script>      cursor:pointer;      cursor:pointer;

    // Theme toggle

    const themeBtn = document.getElementById('themeToggle');    }    }

    

    function applyTheme(theme) {

      document.documentElement.setAttribute('data-theme', theme);

      localStorage.setItem('theme', theme);    .post-caption{    .post-caption{

      if (themeBtn) {

        themeBtn.innerHTML = theme === 'dark'       padding:12px 16px 0;      padding:12px 16px 0;

          ? '<i class="fas fa-sun"></i> Modo claro' 

          : '<i class="fas fa-moon"></i> Modo oscuro';      font-size:.95rem;      font-size:.95rem;

      }

    }      line-height:1.5;      line-height:1.5;

    

    themeBtn?.addEventListener('click', () => {    }    }

      const current = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';

      applyTheme(current === 'dark' ? 'light' : 'dark');

    });

        .post-actions{    .post-actions{

    (function() {

      const t = document.documentElement.getAttribute('data-theme');      display:flex;      display:flex;

      if (themeBtn) {

        themeBtn.innerHTML = t === 'dark'       gap:16px;      gap:16px;

          ? '<i class="fas fa-sun"></i> Modo claro' 

          : '<i class="fas fa-moon"></i> Modo oscuro';      padding:8px 16px;      padding:8px 16px;

      }

    })();      border-top:1px solid var(--line);      border-top:1px solid var(--line);



    // API    }    }

    const API = (p) => `${location.origin}/api${p}`;

    const token = localStorage.getItem('token');

    if (!token) { location.replace('index.html'); }

        .btn-icon{    .btn-icon{

    const H = { 'Authorization': `Bearer ${token}` };

    const $ = (s) => document.querySelector(s);      background:none;      background:none;

    

    function displayName(u) {      border:none;      border:none;

      return u?.name || `${u?.firstName || ''} ${u?.lastName || ''}`.trim() || (u?.nickname || 'Usuario');

    }      color:var(--muted);      color:var(--muted);

    

    function abs(url) {      cursor:pointer;      cursor:pointer;

      return url?.startsWith('http') ? url : `${location.origin}${url?.startsWith('/') ? url : '/' + url}`;

    }      padding:8px 12px;      padding:8px 12px;

    

    function resolveAvatar(u) {      font-size:1rem;      font-size:1rem;

      if (u?.avatar) return abs(u.avatar);

      const seed = encodeURIComponent(displayName(u) || u?.nickname || 'U');      transition:.2s ease;      transition:.2s ease;

      return `https://api.dicebear.com/8.x/initials/svg?seed=${seed}&radius=50&scale=110&fontWeight=700`;

    }      display:flex;      display:flex;

    

    function timeAgo(iso) {      align-items:center;      align-items:center;

      try {

        const d = new Date(iso);      gap:8px;      gap:8px;

        const s = (Date.now() - d) / 1000;

        if (s < 60) return 'ahora';    }    }

        if (s < 3600) return Math.floor(s / 60) + ' min';

        if (s < 86400) return Math.floor(s / 3600) + ' h';

        return Math.floor(s / 86400) + ' d';

      } catch { return ''; }    .btn-icon:hover{    .btn-icon:hover{

    }

      color:var(--primary);      color:var(--primary);

    async function toggleFollow(id, isFollowing) {

      try {    }    }

        const r = await fetch(API(`/follow/toggle/${id}`), { method: 'POST', headers: H });

        if (r.status !== 404) {

          const d = await r.json();

          return !!d.ok;    .btn-icon[aria-pressed="true"]{    .btn-icon[aria-pressed="true"]{

        }

      } catch {}      color:var(--accent);      color:var(--accent);

      

      if (!isFollowing) {    }    }

        const r = await fetch(API(`/follow/${id}`), { method: 'POST', headers: H });

        const d = await r.json();

        return !!d.ok;

      } else {    .post-counts{    .post-counts{

        const r = await fetch(API(`/follow/${id}`), { method: 'DELETE', headers: H });

        const d = await r.json();      color:var(--muted);      color:var(--muted);

        return !!d.ok;

      }      font-size:.85rem;      font-size:.85rem;

    }

          margin:8px 16px;      margin:8px 16px;

    function personRow(u) {

      const el = document.createElement('div');    }    }

      el.className = 'person-row';

      el.innerHTML = `

        <div class="p-avatar"><img src="${resolveAvatar(u)}" alt=""></div>

        <div class="p-info">    .post-counts strong{    .post-counts strong{

          <div class="p-name" title="${displayName(u)}">${displayName(u)}</div>

          <div class="p-user" title="@${u.nickname || 'usuario'}">@${u.nickname || 'usuario'}</div>      color:var(--text);      color:var(--text);

        </div>

        <div class="p-actions">      font-weight:700;      font-weight:700;

          <a class="btn" href="profile.html?id=${u._id}"><i class="fas fa-eye"></i></a>

          <button class="btn">${u.isFollowing ? '<i class="fas fa-user-check"></i>' : '<i class="fas fa-user-plus"></i>'}</button>    }    }

        </div>`;

      const btn = el.querySelector('button');

      btn.onclick = async () => {

        btn.disabled = true;    /* ====== LOAD MORE ====== */    /* ====== LOAD MORE ====== */

        const ok = await toggleFollow(u._id, !!u.isFollowing);

        if (ok) {    .load-more{    .load-more{

          u.isFollowing = !u.isFollowing;

          btn.innerHTML = u.isFollowing ? '<i class="fas fa-user-check"></i>' : '<i class="fas fa-user-plus"></i>';      padding:20px;      padding:20px;

        }

        btn.disabled = false;      text-align:center;      text-align:center;

      };

      return el;    }    }

    }

    

    async function loadOthers() {

      const list = document.querySelector('#peopleList');    /* ====== RIGHT SIDEBAR ====== */    /* ====== RIGHT SIDEBAR ====== */

      if (!list) return;

      list.innerHTML = '';    .aside{    .aside{

      const r = await fetch(API('/user/others'), { headers: H });

      const d = await r.json();      position:sticky;      position:sticky;

      if (!d.ok || !d.users?.length) {

        list.innerHTML = '<div style="color: var(--muted);">No hay sugerencias por ahora.</div>';      top:60px;      top:60px;

        return;

      }      height:fit-content;      height:fit-content;

      d.users.forEach(u => list.appendChild(personRow(u)));

    }      padding:20px;      padding:20px;



    let me = null;      background:var(--panel);      background:var(--panel);

    const userCache = new Map();

          border-left:1px solid var(--line);      border-left:1px solid var(--line);

    async function loadMe() {

      const r = await fetch(API('/user/me'), { headers: H });    }    }

      const d = await r.json();

      if (!d.ok) {

        localStorage.clear();

        return location.replace('index.html');    .aside h3{    .aside h3{

      }

      me = d.user;      margin:0 0 16px;      margin:0 0 16px;

      userCache.set(me._id, me);

      document.querySelector('#cmpAvatar').src = resolveAvatar(me);      font-size:1.1rem;      font-size:1.1rem;

    }

      font-weight:700;      font-weight:700;

    const cmp = {

      fileEl: document.querySelector('#cmpFile'),    }    }

      pick: document.querySelector('#cmpPick'),

      imgBox: document.querySelector('#cmpPreview'),

      img: document.querySelector('#cmpPreviewImg'),

      rm: document.querySelector('#cmpRemoveImg'),    .people-list{    .people-list{

      txt: document.querySelector('#cmpText'),

      post: document.querySelector('#cmpPost'),      display:grid;      display:grid;

      msg: document.querySelector('#cmpMsg')

    };      gap:12px;      gap:12px;

    

    let selectedFile = null;    }    }

    

    cmp.pick.onclick = () => cmp.fileEl.click();

    cmp.fileEl.onchange = (e) => {

      const f = e.target.files?.[0];    .person-row{    .person-row{

      if (!f) {

        selectedFile = null;      display:flex;      display:flex;

        cmp.imgBox.style.display = 'none';

        return;      gap:10px;      gap:10px;

      }

      selectedFile = f;      align-items:center;      align-items:center;

      cmp.img.src = URL.createObjectURL(f);

      cmp.imgBox.style.display = 'flex';      padding:10px;      padding:10px;

    };

    cmp.rm.onclick = () => {      background:var(--bg);      background:var(--bg);

      selectedFile = null;

      cmp.fileEl.value = '';      border-radius:var(--radius);      border-radius:var(--radius);

      cmp.imgBox.style.display = 'none';

      cmp.img.removeAttribute('src');      transition:.2s ease;      transition:.2s ease;

    };

    }    }

    async function publish() {

      cmp.post.disabled = true;

      cmp.msg.textContent = 'Publicando...';

      try {    .person-row:hover{    .person-row:hover{

        const fd = new FormData();

        if (selectedFile) fd.append('image', selectedFile);      background:var(--line);      background:var(--line);

        if (cmp.txt.value.trim()) fd.append('caption', cmp.txt.value.trim());

        const r = await fetch(API('/posts'), { method: 'POST', headers: H, body: fd });    }    }

        const d = await r.json();

        if (!d.ok) throw new Error(d.message || 'Error');

        prependPost(d.post);

        cmp.msg.textContent = '¡Publicado!';    .p-avatar img{    .p-avatar img{

        cmp.txt.value = '';

        cmp.rm.click();      width:36px;      width:36px;

        setTimeout(() => cmp.msg.textContent = '', 1200);

      } catch {      height:36px;      height:36px;

        cmp.msg.textContent = 'No se pudo publicar';

      } finally {      border-radius:50%;      border-radius:50%;

        cmp.post.disabled = false;

      }      object-fit:cover;      object-fit:cover;

    }

        }    }

    cmp.post.onclick = publish;



    const feedEl = document.querySelector('#feed');

    let nextCursor = null;    .p-info{    .p-info{

    let loading = false;

      flex:1;      flex:1;

    async function getUserCached(id) {

      if (userCache.has(id)) return userCache.get(id);      min-width:0;      min-width:0;

      const r = await fetch(API(`/user/${id}/public`), { headers: H });

      const d = await r.json();    }    }

      if (d.ok) {

        userCache.set(id, d.user);

        return d.user;

      }    .p-name{    .p-name{

      return { nickname: 'usuario', firstName: '', lastName: '', avatar: null };

    }      font-weight:700;      font-weight:700;



    // Lightbox      font-size:.9rem;      font-size:.9rem;

    const lb = document.getElementById('lightbox');

    const lbClose = document.getElementById('lbClose');      white-space:nowrap;      white-space:nowrap;

    const lbImg = document.getElementById('lbImg');

    const lbAva = document.getElementById('lbAva');      overflow:hidden;      overflow:hidden;

    const lbName = document.getElementById('lbName');

    const lbUser = document.getElementById('lbUser');      text-overflow:ellipsis;      text-overflow:ellipsis;

    const lbBody = document.getElementById('lbComments');

    const lbInp = document.getElementById('lbInp');    }    }

    const lbSend = document.getElementById('lbSend');



    async function listPostComments(postId) {

      const r = await fetch(API(`/posts/${postId}/comments?limit=100`), { headers: H });    .p-user{    .p-user{

      const d = await r.json();

      return d.ok ? d.comments : [];      color:var(--muted);      color:var(--muted);

    }

          font-size:.8rem;      font-size:.8rem;

    async function addPostComment(postId, text) {

      const r = await fetch(API(`/posts/${postId}/comments`), {      white-space:nowrap;      white-space:nowrap;

        method: 'POST',

        headers: { ...H, 'Content-Type': 'application/json' },      overflow:hidden;      overflow:hidden;

        body: JSON.stringify({ text })

      });      text-overflow:ellipsis;      text-overflow:ellipsis;

      const d = await r.json();

      return d.ok ? d.comment : null;    }    }

    }

    

    async function renderComments(list) {

      lbBody.innerHTML = '';    .p-actions{    .p-actions{

      for (const c of list) {

        if (!userCache.has(c.userId)) await getUserCached(c.userId);      margin-left:auto;      margin-left:auto;

      }

      list.forEach(c => {      display:flex;      display:flex;

        const u = userCache.get(c.userId);

        const nm = displayName(u) || 'usuario';      gap:6px;      gap:6px;

        const row = document.createElement('div');

        row.className = 'lb-cmt';    }    }

        row.innerHTML = `<span class="nm">${nm}</span><span>${c.text}</span><span class="dt">${timeAgo(c.createdAt)}</span>`;

        lbBody.appendChild(row);

      });

      lbBody.scrollTop = lbBody.scrollHeight;    .p-actions .btn{    .p-actions .btn{

    }

          padding:6px 12px;      padding:6px 12px;

    async function openPostModal(p) {

      lbImg.src = p.media.t1 || p.media.original || p.media.thumb;      font-size:.85rem;      font-size:.85rem;

      const u = await getUserCached(p.userId);

      lbAva.src = resolveAvatar(u);    }    }

      lbName.textContent = displayName(u);

      lbUser.textContent = `@${u.nickname || 'usuario'}`;

      const comments = await listPostComments(p.id);

      await renderComments(comments);    /* ====== LIGHTBOX ====== */    /* ====== LIGHTBOX ====== */

      lbSend.onclick = async () => {

        const t = lbInp.value.trim();    .lightbox{    .lightbox{

        if (!t) return;

        const c = await addPostComment(p.id, t);      position:fixed;      position:fixed;

        if (c) {

          lbInp.value = '';      inset:0;      inset:0;

          comments.push(c);

          await renderComments(comments);      display:none;      display:none;

        }

      };      align-items:center;      align-items:center;

      lb.setAttribute('aria-hidden', 'false');

    }      justify-content:center;      justify-content:center;

    

    function closePostModal() {      background:rgba(0,0,0,.7);      background:rgba(0,0,0,.7);

      lb.setAttribute('aria-hidden', 'true');

      lbImg.removeAttribute('src');      z-index:100;      z-index:100;

      lbInp.value = '';

      lbBody.innerHTML = '';    }    }

    }

    

    lbClose.onclick = closePostModal;

    lb.addEventListener('click', (e) => {    .lightbox[aria-hidden="false"]{    .lightbox[aria-hidden="false"]{

      if (e.target === lb) closePostModal();

    });      display:flex;      display:flex;

    document.addEventListener('keydown', (e) => {

      if (e.key === 'Escape' && lb.getAttribute('aria-hidden') === 'false') closePostModal();    }    }

    });



    function postCard(p) {

      const el = document.createElement('article');    .lb-content{    .lb-content{

      el.className = 'post-card';

      const author = userCache.get(p.userId) || {};      display:grid;      display:grid;

      el.innerHTML = `

        <header class="post-head">      grid-template-columns:min(60vw,600px) 360px;      grid-template-columns:min(60vw,600px) 360px;

          <div style="display: flex; gap: 12px; align-items: center; flex: 1;">

            <img class="post-ava" src="${resolveAvatar(author)}" alt="">      gap:0;      gap:0;

            <div class="post-user">

              <a class="post-name" href="profile.html?id=${p.userId}">${displayName(author)}</a>      background:var(--card);      background:var(--card);

              <div class="post-userid">@${author.nickname || 'usuario'} · ${timeAgo(p.createdAt)}</div>

            </div>      border-radius:8px;      border-radius:8px;

          </div>

        </header>      max-height:90vh;      max-height:90vh;

        ${p.media?.thumb ? `<div class="post-media"><img class="post-img" src="${p.media.thumb}" alt=""></div>` : ''}

        ${p.caption ? `<div class="post-caption">${p.caption}</div>` : ''}      overflow:hidden;      overflow:hidden;

        <div class="post-counts"><strong><span class="likes">${p.counts?.likes || 0}</span></strong> me gusta · <strong><span class="comments">${p.counts?.comments || 0}</span></strong> comentarios</div>

        <div class="post-actions">    }    }

          <button class="btn-icon btn-like" aria-pressed="${p.viewerLiked ? 'true' : 'false'}" title="Me gusta">

            <i class="fa${p.viewerLiked ? 's' : 'r'} fa-heart"></i> Me gusta

          </button>

          <button class="btn-icon btn-comment" title="Comentar">    @media (max-width:1080px){    @media (max-width:1080px){

            <i class="far fa-comment"></i> Comentar

          </button>      .lb-content{grid-template-columns:1fr}      .lb-content{grid-template-columns:1fr}

        </div>`;

      .lb-side{grid-template-rows:auto 1fr auto}      .lb-side{grid-template-rows:auto 1fr auto}

      const likeBtn = el.querySelector('.btn-like');

      const likesEl = el.querySelector('.likes');    }    }

      

      likeBtn.onclick = async () => {

        const pressed = likeBtn.getAttribute('aria-pressed') === 'true';

        likeBtn.setAttribute('aria-pressed', (!pressed) + '');    .lb-close{    .lb-close{

        likeBtn.innerHTML = pressed

          ? '<i class="far fa-heart"></i> Me gusta'      position:absolute;      position:absolute;

          : '<i class="fas fa-heart"></i> Me gusta';

        likesEl.textContent = (+likesEl.textContent + (pressed ? -1 : 1));      right:12px;      right:12px;

        try {

          const r = await fetch(API(`/posts/${p.id}/likes/toggle`), { method: 'POST', headers: H });      top:12px;      top:12px;

          const d = await r.json();

          if (!d.ok) throw 0;      background:rgba(0,0,0,.5);      background:rgba(0,0,0,.5);

        } catch {

          likeBtn.setAttribute('aria-pressed', pressed + '');      border:none;      border:none;

          likeBtn.innerHTML = pressed

            ? '<i class="fas fa-heart"></i> Me gusta'      color:white;      color:white;

            : '<i class="far fa-heart"></i> Me gusta';

          likesEl.textContent = (+likesEl.textContent + (pressed ? 1 : -1));      width:36px;      width:36px;

        }

      };      height:36px;      height:36px;



      el.querySelector('.btn-comment').onclick = () => openPostModal(p);      border-radius:50%;      border-radius:50%;

      const imgEl = el.querySelector('.post-img');

      if (imgEl) imgEl.onclick = () => openPostModal(p);      cursor:pointer;      cursor:pointer;



      return el;      font-size:1.2rem;      font-size:1.2rem;

    }

      display:flex;      display:flex;

    async function renderPost(p) {

      if (!userCache.has(p.userId)) await getUserCached(p.userId);      align-items:center;      align-items:center;

      feedEl.appendChild(postCard(p));

    }      justify-content:center;      justify-content:center;

    

    function prependPost(p) {      z-index:101;      z-index:101;

      if (!userCache.has(p.userId)) userCache.set(p.userId, me);

      feedEl.prepend(postCard(p));    }    }

    }



    async function loadFeed(first = false) {

      if (loading) return;    .lb-media{    .lb-media{

      loading = true;

      try {      background:var(--bg);      background:var(--bg);

        const url = new URL(API('/posts'));

        url.searchParams.set('limit', '10');      border-bottom:1px solid var(--line);      border-bottom:1px solid var(--line);

        if (nextCursor) url.searchParams.set('cursor', nextCursor);

        const r = await fetch(url.toString(), { headers: H });      overflow:hidden;      overflow:hidden;

        const d = await r.json();

        if (!d.ok) return;    }    }

        for (const p of d.posts || []) await renderPost(p);

        nextCursor = d.nextCursor || null;

        document.getElementById('btnMore').style.display = nextCursor ? 'inline-flex' : 'none';

      } finally {    .lb-media img{    .lb-media img{

        loading = false;

      }      display:block;      display:block;

    }

      width:100%;      width:100%;

    document.getElementById('logoutBtnTop')?.addEventListener('click', () => {

      localStorage.removeItem('token');      height:100%;      height:100%;

      localStorage.removeItem('user');

      location.replace('index.html');      object-fit:cover;      object-fit:cover;

    });

    }    }

    (async () => {

      await loadMe();

      await loadOthers();

      await loadFeed(true);    .lb-side{    .lb-side{

    })();

          display:grid;      display:grid;

    document.getElementById('btnMore').onclick = () => loadFeed();

  </script>      grid-template-rows:auto 1fr auto;      grid-template-rows:auto 1fr auto;

</body>

</html>    }    }




    .lb-head{    .lb-head{

      display:flex;      display:flex;

      gap:10px;      gap:10px;

      align-items:center;      align-items:center;

      padding:12px 14px;      padding:12px 14px;

      border-bottom:1px solid var(--line);      border-bottom:1px solid var(--line);

    }    }



    .lb-ava{    .lb-ava{

      width:36px;      width:36px;

      height:36px;      height:36px;

      border-radius:50%;      border-radius:50%;

      object-fit:cover;      object-fit:cover;

    }    }



    .lb-body{    .lb-body{

      padding:12px 14px;      padding:12px 14px;

      overflow-y:auto;      overflow-y:auto;

      max-height:50vh;      max-height:50vh;

    }    }



    .lb-cmt{    .lb-cmt{

      display:flex;      display:flex;

      gap:8px;      gap:8px;

      margin-bottom:8px;      margin-bottom:8px;

      font-size:.9rem;      font-size:.9rem;

    }    }



    .lb-cmt .nm{    .lb-cmt .nm{

      font-weight:700;      font-weight:700;

      flex-shrink:0;      flex-shrink:0;

    }    }



    .lb-cmt .dt{    .lb-cmt .dt{

      color:var(--muted);      color:var(--muted);

      font-size:.8rem;      font-size:.8rem;

      flex-shrink:0;      flex-shrink:0;

    }    }



    .lb-input{    .lb-input{

      display:flex;      display:flex;

      gap:8px;      gap:8px;

      padding:12px 14px;      padding:12px 14px;

      border-top:1px solid var(--line);      border-top:1px solid var(--line);

    }    }



    .lb-input input{    .lb-input input{

      flex:1;      flex:1;

      background:var(--bg);      background:var(--bg);

      border:1px solid var(--line);      border:1px solid var(--line);

      border-radius:20px;      border-radius:20px;

      color:var(--text);      color:var(--text);

      padding:8px 16px;      padding:8px 16px;

      font-family:inherit;      font-family:inherit;

      outline:none;      outline:none;

    }    }



    .lb-input input:focus{    .lb-input input:focus{

      border-color:var(--primary);      border-color:var(--primary);

    }    }



    .lb-input .btn{    .lb-input .btn{

      padding:8px 16px;      padding:8px 16px;

    }    }



    /* ====== RESPONSIVE ====== */    /* ====== RESPONSIVE ====== */

    @media (max-width:1080px){    @media (max-width:1080px){

      .layout{      .layout{

        grid-template-columns:1fr;        grid-template-columns:1fr;

      }      }

      .sidebar{      .sidebar{

        display:none;        display:none;

      }      }

      .aside{      .aside{

        display:none;        display:none;

      }      }

      .main{      .main{

        border-right:none;        border-right:none;

        border-left:none;        border-left:none;

      }      }

    }    }



    @media (max-width:600px){    @media (max-width:600px){

      .topbar-inner{      .topbar-inner{

        padding:12px 16px;        padding:12px 16px;

      }      }

      .composer{      .composer{

        padding:16px;        padding:16px;

      }      }

      .post-head,      .post-head,

      .post-actions,      .post-actions,

      .post-caption{      .post-caption{

        padding-left:12px;        padding-left:12px;

        padding-right:12px;        padding-right:12px;

      }      }

      .lb-content{      .lb-content{

        grid-template-columns:1fr;        grid-template-columns:1fr;

      }      }

    }    }



    /* ====== SCROLLBAR ====== */    /* ====== SCROLLBAR ====== */

    ::-webkit-scrollbar{    ::-webkit-scrollbar{

      width:8px;      width:8px;

    }    }



    ::-webkit-scrollbar-track{    ::-webkit-scrollbar-track{

      background:transparent;      background:transparent;

    }    }



    ::-webkit-scrollbar-thumb{    ::-webkit-scrollbar-thumb{

      background:var(--line);      background:var(--line);

      border-radius:4px;      border-radius:4px;

    }    }



    ::-webkit-scrollbar-thumb:hover{    ::-webkit-scrollbar-thumb:hover{

      background:var(--muted);      background:var(--muted);

    }    }

  </style>  </style>

</head></head>

<body><body>

  <!-- Topbar -->  <!-- Topbar -->

  <header class="topbar">  <header class="topbar">

    <div class="topbar-inner">    <div class="topbar-inner">

      <div class="brand">      <div class="brand">

        <i class="fas fa-circle"></i> DACEM        <i class="fas fa-circle"></i> DACEM

      </div>      </div>

      <div class="topbar-actions">      <div class="topbar-actions">

        <button id="themeToggle" class="btn" title="Cambiar tema">        <button id="themeToggle" class="btn" title="Cambiar tema">

          <i class="fas fa-moon"></i> Modo oscuro          <i class="fas fa-moon"></i> Modo oscuro

        </button>        </button>

        <button id="logoutBtnTop" class="btn danger">        <button id="logoutBtnTop" class="btn danger">

          <i class="fas fa-sign-out-alt"></i> Cerrar sesión          <i class="fas fa-sign-out-alt"></i> Cerrar sesión

        </button>        </button>

      </div>      </div>

    </div>    </div>

  </header>  </header>



  <div class="wrap">  <div class="wrap">

    <div class="layout">    <div class="layout">

      <!-- Sidebar Izquierdo -->      <!-- Sidebar Izquierdo -->

      <aside class="sidebar">      <aside class="sidebar">

        <nav class="nav">        <nav class="nav">

          <a class="nav-item active" href="user.html">          <a class="nav-item active" href="user.html">

            <i class="fas fa-home"></i> Inicio            <i class="fas fa-home"></i> Inicio

          </a>          </a>

          <a class="nav-item" href="profile.html">          <a class="nav-item" href="profile.html">

            <i class="fas fa-user"></i> Mi perfil            <i class="fas fa-user"></i> Mi perfil

          </a>          </a>

        </nav>        </nav>

      </aside>      </aside>



      <!-- Main Feed -->      <!-- Main Feed -->

      <main class="main">      <main class="main">

        <!-- Composer -->        <!-- Composer -->

        <section class="card composer" id="composer">        <section class="card composer" id="composer">

          <div class="cmp-row">          <div class="cmp-row">

            <img id="cmpAvatar" class="cmp-avatar" alt="yo">            <img id="cmpAvatar" class="cmp-avatar" alt="yo">

            <textarea id="cmpText" class="cmp-input" rows="2" placeholder="¿Qué estás pensando? (opcional)"></textarea>            <textarea id="cmpText" class="cmp-input" rows="2" placeholder="¿Qué estás pensando? (opcional)"></textarea>

          </div>          </div>

          <div id="cmpPreview" class="cmp-preview" style="display:none">          <div id="cmpPreview" class="cmp-preview" style="display:none">

            <img id="cmpPreviewImg" alt="preview">            <img id="cmpPreviewImg" alt="preview">

            <button id="cmpRemoveImg" class="btn">            <button id="cmpRemoveImg" class="btn">

              <i class="fas fa-times"></i> Quitar              <i class="fas fa-times"></i> Quitar

            </button>            </button>

          </div>          </div>

          <div class="cmp-tools">          <div class="cmp-tools">

            <input id="cmpFile" type="file" accept="image/*" hidden>            <input id="cmpFile" type="file" accept="image/*" hidden>

            <button id="cmpPick" class="btn">            <button id="cmpPick" class="btn">

              <i class="fas fa-image"></i> Imagen              <i class="fas fa-image"></i> Imagen

            </button>            </button>

            <div class="spacer"></div>            <div class="spacer"></div>

            <button id="cmpPost" class="btn primary">            <button id="cmpPost" class="btn primary">

              <i class="fas fa-paper-plane"></i> Publicar              <i class="fas fa-paper-plane"></i> Publicar

            </button>            </button>

          </div>          </div>

          <div class="cmp-msg" id="cmpMsg"></div>          <div class="cmp-msg" id="cmpMsg"></div>

        </section>        </section>



        <!-- Feed -->        <!-- Feed -->

        <section class="feed" id="feed"></section>        <section class="feed" id="feed"></section>

        <div class="load-more">        <div class="load-more">

          <button id="btnMore" class="btn primary">          <button id="btnMore" class="btn primary">

            <i class="fas fa-chevron-down"></i> Cargar más            <i class="fas fa-chevron-down"></i> Cargar más

          </button>          </button>

        </div>        </div>

      </main>      </main>



      <!-- Sidebar Derecho - Personas -->      <!-- Sidebar Derecho - Personas -->

      <aside class="aside">      <aside class="aside">

        <h3>        <h3>

          <i class="fas fa-users"></i> Personas          <i class="fas fa-users"></i> Personas

        </h3>        </h3>

        <div id="peopleList" class="people-list"></div>        <div id="peopleList" class="people-list"></div>

      </aside>      </aside>

    </div>    </div>

  </div>  </div>



  <!-- Lightbox Post -->  <!-- Lightbox Post -->

  <div class="lightbox" id="lightbox" aria-hidden="true">  <div class="lightbox" id="lightbox" aria-hidden="true">

    <button class="lb-close" id="lbClose">    <button class="lb-close" id="lbClose">

      <i class="fas fa-times"></i>      <i class="fas fa-times"></i>

    </button>    </button>

    <div class="lb-content" role="dialog" aria-modal="true" aria-label="Publicación">    <div class="lb-content" role="dialog" aria-modal="true" aria-label="Publicación">

      <div class="lb-media"><img id="lbImg" alt=""></div>      <div class="lb-media"><img id="lbImg" alt=""></div>

      <aside class="lb-side">      <aside class="lb-side">

        <header class="lb-head">        <header class="lb-head">

          <img id="lbAva" class="lb-ava" alt="">          <img id="lbAva" class="lb-ava" alt="">

          <div>          <div>

            <div id="lbName" style="font-weight:700"></div>            <div id="lbName" style="font-weight:700"></div>

            <div id="lbUser" class="muted" style="font-size:12px"></div>            <div id="lbUser" class="muted" style="font-size:12px"></div>

          </div>          </div>

        </header>        </header>

        <div class="lb-body" id="lbComments"></div>        <div class="lb-body" id="lbComments"></div>

        <div class="lb-input">        <div class="lb-input">

          <input id="lbInp" placeholder="Añade un comentario…">          <input id="lbInp" placeholder="Añade un comentario…">

          <button id="lbSend" class="btn primary">          <button id="lbSend" class="btn primary">

            <i class="fas fa-paper-plane"></i>            <i class="fas fa-paper-plane"></i>

          </button>          </button>

        </div>        </div>

      </aside>      </aside>

    </div>    </div>

  </div>  </div>



  <!-- ===== JS ===== -->  <!-- ===== JS ===== -->

  <script>  <script>

    // Toggle tema    // Toggle tema

    const themeBtn = document.getElementById('themeToggle');    const themeBtn = document.getElementById('themeToggle');

    function applyTheme(t){    function applyTheme(t){

      document.documentElement.setAttribute('data-theme', t);      document.documentElement.setAttribute('data-theme', t);

      localStorage.setItem('theme', t);      localStorage.setItem('theme', t);

      if(themeBtn) themeBtn.innerHTML = t==='dark' ? '<i class="fas fa-sun"></i> Modo claro' : '<i class="fas fa-moon"></i> Modo oscuro';      if(themeBtn) themeBtn.innerHTML = t==='dark' ? '<i class="fas fa-sun"></i> Modo claro' : '<i class="fas fa-moon"></i> Modo oscuro';

    }    }

    themeBtn?.addEventListener('click', ()=>{    themeBtn?.addEventListener('click', ()=>{

      const current = document.documentElement.getAttribute('data-theme')==='dark' ? 'dark' : 'light';      const current = document.documentElement.getAttribute('data-theme')==='dark' ? 'dark' : 'light';

      applyTheme(current==='dark' ? 'light' : 'dark');      applyTheme(current==='dark' ? 'light' : 'dark');

    });    });

    (function(){ const t=document.documentElement.getAttribute('data-theme'); if(themeBtn) themeBtn.innerHTML = t==='dark' ? '<i class="fas fa-sun"></i> Modo claro' : '<i class="fas fa-moon"></i> Modo oscuro'; })();    (function(){ const t=document.documentElement.getAttribute('data-theme'); if(themeBtn) themeBtn.innerHTML = t==='dark' ? '<i class="fas fa-sun"></i> Modo claro' : '<i class="fas fa-moon"></i> Modo oscuro'; })();



    // ===== Helpers / API =====    // ===== Helpers / API =====

    const API = (p)=>`${location.origin}/api${p}`;    const API = (p)=>`${location.origin}/api${p}`;

    const token = localStorage.getItem('token');    const token = localStorage.getItem('token');

    if(!token){ location.replace('index.html'); }    if(!token){ location.replace('index.html'); }



    const H  = { 'Authorization':`Bearer ${token}` };    const H  = { 'Authorization':`Bearer ${token}` };

    const $  = s => document.querySelector(s);    const $  = s => document.querySelector(s);



    function displayName(u){ return u?.name || `${u?.firstName||''} ${u?.lastName||''}`.trim() || (u?.nickname || 'Usuario'); }    function displayName(u){ return u?.name || `${u?.firstName||''} ${u?.lastName||''}`.trim() || (u?.nickname || 'Usuario'); }

    function abs(url){ return url?.startsWith('http') ? url : `${location.origin}${url?.startsWith('/')?url:'/'+url}`; }    function abs(url){ return url?.startsWith('http') ? url : `${location.origin}${url?.startsWith('/')?url:'/'+url}`; }

    function resolveAvatar(u){    function resolveAvatar(u){

      if(u?.avatar) return abs(u.avatar);      if(u?.avatar) return abs(u.avatar);

      const seed = encodeURIComponent(displayName(u) || u?.nickname || 'U');      const seed = encodeURIComponent(displayName(u) || u?.nickname || 'U');

      return `https://api.dicebear.com/8.x/initials/svg?seed=${seed}&radius=50&scale=110&fontWeight=700`;      return `https://api.dicebear.com/8.x/initials/svg?seed=${seed}&radius=50&scale=110&fontWeight=700`;

    }    }

    function timeAgo(iso){ try{ const d=new Date(iso); const s=(Date.now()-d)/1000; if(s<60) return 'ahora'; if(s<3600) return Math.floor(s/60)+' min'; if(s<86400) return Math.floor(s/3600)+' h'; return Math.floor(s/86400)+' d'; }catch{ return ''; } }    function timeAgo(iso){ try{ const d=new Date(iso); const s=(Date.now()-d)/1000; if(s<60) return 'ahora'; if(s<3600) return Math.floor(s/60)+' min'; if(s<86400) return Math.floor(s/3600)+' h'; return Math.floor(s/86400)+' d'; }catch{ return ''; } }



    async function toggleFollow(id, isFollowing){    async function toggleFollow(id, isFollowing){

      try{ const r = await fetch(API(`/follow/toggle/${id}`), { method:'POST', headers:H }); if (r.status !== 404){ const d = await r.json(); return !!d.ok; } }      try{ const r = await fetch(API(`/follow/toggle/${id}`), { method:'POST', headers:H }); if (r.status !== 404){ const d = await r.json(); return !!d.ok; } }

      catch{}      catch{}

      if (!isFollowing){ const r = await fetch(API(`/follow/${id}`), { method:'POST', headers:H }); const d = await r.json(); return !!d.ok; }      if (!isFollowing){ const r = await fetch(API(`/follow/${id}`), { method:'POST', headers:H }); const d = await r.json(); return !!d.ok; }

      else { const r = await fetch(API(`/follow/${id}`), { method:'DELETE', headers:H }); const d = await r.json(); return !!d.ok; }      else { const r = await fetch(API(`/follow/${id}`), { method:'DELETE', headers:H }); const d = await r.json(); return !!d.ok; }

    }    }

    function personRow(u){    function personRow(u){

      const el = document.createElement('div');      const el = document.createElement('div');

      el.className = 'person-row';      el.className = 'person-row';

      el.innerHTML = `      el.innerHTML = `

        <div class="p-avatar"><img src="${resolveAvatar(u)}" alt=""></div>        <div class="p-avatar"><img src="${resolveAvatar(u)}" alt=""></div>

        <div class="p-info">        <div class="p-info">

          <div class="p-name" title="${displayName(u)}">${displayName(u)}</div>          <div class="p-name" title="${displayName(u)}">${displayName(u)}</div>

          <div class="p-user" title="@${u.nickname || 'usuario'}">@${u.nickname || 'usuario'}</div>          <div class="p-user" title="@${u.nickname || 'usuario'}">@${u.nickname || 'usuario'}</div>

        </div>        </div>

        <div class="p-actions">        <div class="p-actions">

          <a class="btn" href="profile.html?id=${u._id}"><i class="fas fa-eye"></i></a>          <a class="btn" href="profile.html?id=${u._id}"><i class="fas fa-eye"></i></a>

          <button class="btn">${u.isFollowing?'<i class="fas fa-user-check"></i>':'<i class="fas fa-user-plus"></i>'}</button>          <button class="btn">${u.isFollowing?'<i class="fas fa-user-check"></i>':'<i class="fas fa-user-plus"></i>'}</button>

        </div>`;        </div>`;

      const btn = el.querySelector('button');      const btn = el.querySelector('button');

      btn.onclick = async () => {      btn.onclick = async () => {

        btn.disabled = true;        btn.disabled = true;

        const ok = await toggleFollow(u._id, !!u.isFollowing);        const ok = await toggleFollow(u._id, !!u.isFollowing);

        if (ok){ u.isFollowing=!u.isFollowing; btn.innerHTML = u.isFollowing?'<i class="fas fa-user-check"></i>':'<i class="fas fa-user-plus"></i>'; }        if (ok){ u.isFollowing=!u.isFollowing; btn.innerHTML = u.isFollowing?'<i class="fas fa-user-check"></i>':'<i class="fas fa-user-plus"></i>'; }

        btn.disabled = false;        btn.disabled = false;

      };      };

      return el;      return el;

    }    }

    async function loadOthers(){    async function loadOthers(){

      const list = document.querySelector('#peopleList'); if (!list) return;      const list = document.querySelector('#peopleList'); if (!list) return;

      list.innerHTML = '';      list.innerHTML = '';

      const r = await fetch(API('/user/others'), { headers:H });      const r = await fetch(API('/user/others'), { headers:H });

      const d = await r.json();      const d = await r.json();

      if(!d.ok || !d.users?.length){ list.innerHTML = '<div class="muted">No hay sugerencias por ahora.</div>'; return; }      if(!d.ok || !d.users?.length){ list.innerHTML = '<div class="muted">No hay sugerencias por ahora.</div>'; return; }

      d.users.forEach(u => list.appendChild(personRow(u)));      d.users.forEach(u => list.appendChild(personRow(u)));

    }    }



    let me = null; const userCache = new Map();    let me = null; const userCache = new Map();

    async function loadMe(){    async function loadMe(){

      const r = await fetch(API('/user/me'), { headers:H });      const r = await fetch(API('/user/me'), { headers:H });

      const d = await r.json(); if(!d.ok){ localStorage.clear(); return location.replace('index.html'); }      const d = await r.json(); if(!d.ok){ localStorage.clear(); return location.replace('index.html'); }

      me = d.user; userCache.set(me._id, me);      me = d.user; userCache.set(me._id, me);

      document.querySelector('#cmpAvatar').src = resolveAvatar(me);      document.querySelector('#cmpAvatar').src = resolveAvatar(me);

    }    }



    const cmp = { fileEl: document.querySelector('#cmpFile'), pick: document.querySelector('#cmpPick'), imgBox: document.querySelector('#cmpPreview'), img: document.querySelector('#cmpPreviewImg'), rm: document.querySelector('#cmpRemoveImg'), txt: document.querySelector('#cmpText'), post: document.querySelector('#cmpPost'), msg: document.querySelector('#cmpMsg') };    const cmp = { fileEl: document.querySelector('#cmpFile'), pick: document.querySelector('#cmpPick'), imgBox: document.querySelector('#cmpPreview'), img: document.querySelector('#cmpPreviewImg'), rm: document.querySelector('#cmpRemoveImg'), txt: document.querySelector('#cmpText'), post: document.querySelector('#cmpPost'), msg: document.querySelector('#cmpMsg') };

    let selectedFile = null;    let selectedFile = null;

    cmp.pick.onclick = ()=> cmp.fileEl.click();    cmp.pick.onclick = ()=> cmp.fileEl.click();

    cmp.fileEl.onchange = e=>{    cmp.fileEl.onchange = e=>{

      const f = e.target.files?.[0];      const f = e.target.files?.[0];

      if(!f){ selectedFile=null; cmp.imgBox.style.display='none'; return; }      if(!f){ selectedFile=null; cmp.imgBox.style.display='none'; return; }

      selectedFile = f; cmp.img.src = URL.createObjectURL(f); cmp.imgBox.style.display='flex';      selectedFile = f; cmp.img.src = URL.createObjectURL(f); cmp.imgBox.style.display='flex';

    };    };

    cmp.rm.onclick = ()=>{ selectedFile=null; cmp.fileEl.value=''; cmp.imgBox.style.display='none'; cmp.img.removeAttribute('src'); };    cmp.rm.onclick = ()=>{ selectedFile=null; cmp.fileEl.value=''; cmp.imgBox.style.display='none'; cmp.img.removeAttribute('src'); };



    async function publish(){    async function publish(){

      cmp.post.disabled = true; cmp.msg.textContent = 'Publicando...';      cmp.post.disabled = true; cmp.msg.textContent = 'Publicando...';

      try{      try{

        const fd = new FormData();        const fd = new FormData();

        if (selectedFile) fd.append('image', selectedFile);        if (selectedFile) fd.append('image', selectedFile);

        if (cmp.txt.value.trim()) fd.append('caption', cmp.txt.value.trim());        if (cmp.txt.value.trim()) fd.append('caption', cmp.txt.value.trim());

        const r = await fetch(API('/posts'), { method:'POST', headers:H, body:fd });        const r = await fetch(API('/posts'), { method:'POST', headers:H, body:fd });

        const d = await r.json();        const d = await r.json();

        if(!d.ok) throw new Error(d.message||'Error');        if(!d.ok) throw new Error(d.message||'Error');

        prependPost(d.post);        prependPost(d.post);

        cmp.msg.textContent = '¡Publicado!'; cmp.txt.value=''; cmp.rm.click();        cmp.msg.textContent = '¡Publicado!'; cmp.txt.value=''; cmp.rm.click();

        setTimeout(()=>cmp.msg.textContent='', 1200);        setTimeout(()=>cmp.msg.textContent='', 1200);

      }catch{ cmp.msg.textContent = 'No se pudo publicar'; }      }catch{ cmp.msg.textContent = 'No se pudo publicar'; }

      finally{ cmp.post.disabled=false; }      finally{ cmp.post.disabled=false; }

    }    }

    cmp.post.onclick = publish;    cmp.post.onclick = publish;



    const feedEl = document.querySelector('#feed');    const feedEl = document.querySelector('#feed');

    let nextCursor = null, loading = false;    let nextCursor = null, loading = false;



    async function getUserCached(id){    async function getUserCached(id){

      if (userCache.has(id)) return userCache.get(id);      if (userCache.has(id)) return userCache.get(id);

      const r = await fetch(API(`/user/${id}/public`), { headers:H });      const r = await fetch(API(`/user/${id}/public`), { headers:H });

      const d = await r.json(); if (d.ok){ userCache.set(id,d.user); return d.user; }      const d = await r.json(); if (d.ok){ userCache.set(id,d.user); return d.user; }

      return { nickname:'usuario', firstName:'', lastName:'', avatar:null };      return { nickname:'usuario', firstName:'', lastName:'', avatar:null };

    }    }



    // Lightbox    // Lightbox

    const lb = document.getElementById('lightbox'), lbClose = document.getElementById('lbClose');    const lb = document.getElementById('lightbox'), lbClose = document.getElementById('lbClose');

    const lbImg = document.getElementById('lbImg'), lbAva = document.getElementById('lbAva');    const lbImg = document.getElementById('lbImg'), lbAva = document.getElementById('lbAva');

    const lbName = document.getElementById('lbName'), lbUser = document.getElementById('lbUser');    const lbName = document.getElementById('lbName'), lbUser = document.getElementById('lbUser');

    const lbBody = document.getElementById('lbComments'), lbInp = document.getElementById('lbInp'), lbSend = document.getElementById('lbSend');    const lbBody = document.getElementById('lbComments'), lbInp = document.getElementById('lbInp'), lbSend = document.getElementById('lbSend');



    async function listPostComments(postId){    async function listPostComments(postId){

      const r = await fetch(API(`/posts/${postId}/comments?limit=100`), { headers:H });      const r = await fetch(API(`/posts/${postId}/comments?limit=100`), { headers:H });

      const d = await r.json(); return d.ok ? d.comments : [];      const d = await r.json(); return d.ok ? d.comments : [];

    }    }

    async function addPostComment(postId, text){    async function addPostComment(postId, text){

      const r = await fetch(API(`/posts/${postId}/comments`), { method:'POST', headers:{...H,'Content-Type':'application/json'}, body:JSON.stringify({ text }) });      const r = await fetch(API(`/posts/${postId}/comments`), { method:'POST', headers:{...H,'Content-Type':'application/json'}, body:JSON.stringify({ text }) });

      const d = await r.json(); return d.ok ? d.comment : null;      const d = await r.json(); return d.ok ? d.comment : null;

    }    }

    async function renderComments(list){    async function renderComments(list){

      lbBody.innerHTML='';      lbBody.innerHTML='';

      for (const c of list) if (!userCache.has(c.userId)) await getUserCached(c.userId);      for (const c of list) if (!userCache.has(c.userId)) await getUserCached(c.userId);

      list.forEach(c=>{      list.forEach(c=>{

        const u=userCache.get(c.userId), nm=displayName(u)||'usuario';        const u=userCache.get(c.userId), nm=displayName(u)||'usuario';

        const row=document.createElement('div'); row.className='lb-cmt';        const row=document.createElement('div'); row.className='lb-cmt';

        row.innerHTML=`<span class="nm">${nm}</span><span>${c.text}</span><span class="dt">${timeAgo(c.createdAt)}</span>`;        row.innerHTML=`<span class="nm">${nm}</span><span>${c.text}</span><span class="dt">${timeAgo(c.createdAt)}</span>`;

        lbBody.appendChild(row);        lbBody.appendChild(row);

      });      });

      lbBody.scrollTop = lbBody.scrollHeight;      lbBody.scrollTop = lbBody.scrollHeight;

    }    }

    async function openPostModal(p){    async function openPostModal(p){

      lbImg.src = p.media.t1 || p.media.original || p.media.thumb;      lbImg.src = p.media.t1 || p.media.original || p.media.thumb;

      const u = await getUserCached(p.userId);      const u = await getUserCached(p.userId);

      lbAva.src = resolveAvatar(u); lbName.textContent = displayName(u); lbUser.textContent = `@${u.nickname || 'usuario'}`;      lbAva.src = resolveAvatar(u); lbName.textContent = displayName(u); lbUser.textContent = `@${u.nickname || 'usuario'}`;

      const comments = await listPostComments(p.id); await renderComments(comments);      const comments = await listPostComments(p.id); await renderComments(comments);

      lbSend.onclick = async ()=>{ const t = lbInp.value.trim(); if(!t) return;      lbSend.onclick = async ()=>{ const t = lbInp.value.trim(); if(!t) return;

        const c = await addPostComment(p.id, t); if(c){ lbInp.value=''; comments.push(c); await renderComments(comments); } };        const c = await addPostComment(p.id, t); if(c){ lbInp.value=''; comments.push(c); await renderComments(comments); } };

      lb.setAttribute('aria-hidden','false');      lb.setAttribute('aria-hidden','false');

    }    }

    function closePostModal(){ lb.setAttribute('aria-hidden','true'); lbImg.removeAttribute('src'); lbInp.value=''; lbBody.innerHTML=''; }    function closePostModal(){ lb.setAttribute('aria-hidden','true'); lbImg.removeAttribute('src'); lbInp.value=''; lbBody.innerHTML=''; }

    lbClose.onclick = closePostModal;    lbClose.onclick = closePostModal;

    lb.addEventListener('click', (e)=>{ if(e.target===lb) closePostModal(); });    lb.addEventListener('click', (e)=>{ if(e.target===lb) closePostModal(); });

    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && lb.getAttribute('aria-hidden')==='false') closePostModal(); });    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && lb.getAttribute('aria-hidden')==='false') closePostModal(); });



    function postCard(p){    function postCard(p){

      const el = document.createElement('article'); el.className='post-card';      const el = document.createElement('article'); el.className='post-card';

      const author = userCache.get(p.userId) || {};      const author = userCache.get(p.userId) || {};

      el.innerHTML = `      el.innerHTML = `

        <header class="post-head">        <header class="post-head">

          <div style="display:flex;gap:12px;align-items:center;flex:1">          <div style="display:flex;gap:12px;align-items:center;flex:1">

            <img class="post-ava" src="${resolveAvatar(author)}" alt="">            <img class="post-ava" src="${resolveAvatar(author)}" alt="">

            <div class="post-user">            <div class="post-user">

              <a class="post-name" href="profile.html?id=${p.userId}">${displayName(author)}</a>              <a class="post-name" href="profile.html?id=${p.userId}">${displayName(author)}</a>

              <div class="post-userid">@${author.nickname || 'usuario'} · ${timeAgo(p.createdAt)}</div>              <div class="post-userid">@${author.nickname || 'usuario'} · ${timeAgo(p.createdAt)}</div>

            </div>            </div>

          </div>          </div>

        </header>        </header>

        ${p.media?.thumb ? `<div class="post-media"><img class="post-img" src="${p.media.thumb}" alt=""></div>` : ''}        ${p.media?.thumb ? `<div class="post-media"><img class="post-img" src="${p.media.thumb}" alt=""></div>` : ''}

        ${p.caption ? `<div class="post-caption">${p.caption}</div>` : ''}        ${p.caption ? `<div class="post-caption">${p.caption}</div>` : ''}

        <div class="post-counts"><strong><span class="likes">${p.counts?.likes||0}</span></strong> me gusta · <strong><span class="comments">${p.counts?.comments||0}</span></strong> comentarios</div>        <div class="post-counts"><strong><span class="likes">${p.counts?.likes||0}</span></strong> me gusta · <strong><span class="comments">${p.counts?.comments||0}</span></strong> comentarios</div>

        <div class="post-actions">        <div class="post-actions">

          <button class="btn-icon btn-like" aria-pressed="${p.viewerLiked?'true':'false'}" title="Me gusta">          <button class="btn-icon btn-like" aria-pressed="${p.viewerLiked?'true':'false'}" title="Me gusta">

            <i class="fa${p.viewerLiked?'s':'r'} fa-heart"></i> Me gusta            <i class="fa${p.viewerLiked?'s':'r'} fa-heart"></i> Me gusta

          </button>          </button>

          <button class="btn-icon btn-comment" title="Comentar">          <button class="btn-icon btn-comment" title="Comentar">

            <i class="far fa-comment"></i> Comentar            <i class="far fa-comment"></i> Comentar

          </button>          </button>

        </div>`;        </div>`;



      const likeBtn = el.querySelector('.btn-like'); const likesEl = el.querySelector('.likes');      const likeBtn = el.querySelector('.btn-like'); const likesEl = el.querySelector('.likes');

      likeBtn.onclick = async ()=>{      likeBtn.onclick = async ()=>{

        const pressed = likeBtn.getAttribute('aria-pressed')==='true';        const pressed = likeBtn.getAttribute('aria-pressed')==='true';

        likeBtn.setAttribute('aria-pressed',(!pressed)+'');        likeBtn.setAttribute('aria-pressed',(!pressed)+'');

        likeBtn.innerHTML = pressed ? '<i class="far fa-heart"></i> Me gusta' : '<i class="fas fa-heart"></i> Me gusta';        likeBtn.innerHTML = pressed ? '<i class="far fa-heart"></i> Me gusta' : '<i class="fas fa-heart"></i> Me gusta';

        likesEl.textContent=(+likesEl.textContent+(pressed?-1:1));        likesEl.textContent=(+likesEl.textContent+(pressed?-1:1));

        try{        try{

          const r=await fetch(API(`/posts/${p.id}/likes/toggle`), {method:'POST', headers:H});          const r=await fetch(API(`/posts/${p.id}/likes/toggle`), {method:'POST', headers:H});

          const d=await r.json(); if(!d.ok) throw 0;          const d=await r.json(); if(!d.ok) throw 0;

        } catch{        } catch{

          likeBtn.setAttribute('aria-pressed',pressed+'');          likeBtn.setAttribute('aria-pressed',pressed+'');

          likeBtn.innerHTML = pressed ? '<i class="fas fa-heart"></i> Me gusta' : '<i class="far fa-heart"></i> Me gusta';          likeBtn.innerHTML = pressed ? '<i class="fas fa-heart"></i> Me gusta' : '<i class="far fa-heart"></i> Me gusta';

          likesEl.textContent=(+likesEl.textContent+(pressed?1:-1));          likesEl.textContent=(+likesEl.textContent+(pressed?1:-1));

        }        }

      };      };



      el.querySelector('.btn-comment').onclick = ()=> openPostModal(p);      el.querySelector('.btn-comment').onclick = ()=> openPostModal(p);

      const imgEl = el.querySelector('.post-img');      const imgEl = el.querySelector('.post-img');

      if(imgEl) imgEl.onclick = ()=> openPostModal(p);      if(imgEl) imgEl.onclick = ()=> openPostModal(p);



      return el;      return el;

    }    }



    async function renderPost(p){    async function renderPost(p){

      if(!userCache.has(p.userId)) await getUserCached(p.userId);      if(!userCache.has(p.userId)) await getUserCached(p.userId);

      feedEl.appendChild(postCard(p));      feedEl.appendChild(postCard(p));

    }    }

    function prependPost(p){    function prependPost(p){

      if(!userCache.has(p.userId)) userCache.set(p.userId, me);      if(!userCache.has(p.userId)) userCache.set(p.userId, me);

      feedEl.prepend(postCard(p));      feedEl.prepend(postCard(p));

    }    }



    async function loadFeed(first=false){    async function loadFeed(first=false){

      if (loading) return; loading=true;      if (loading) return; loading=true;

      try{      try{

        const url = new URL(API('/posts')); url.searchParams.set('limit','10');        const url = new URL(API('/posts')); url.searchParams.set('limit','10');

        if (nextCursor) url.searchParams.set('cursor', nextCursor);        if (nextCursor) url.searchParams.set('cursor', nextCursor);

        const r = await fetch(url.toString(), { headers:H }); const d = await r.json(); if(!d.ok) return;        const r = await fetch(url.toString(), { headers:H }); const d = await r.json(); if(!d.ok) return;

        for(const p of d.posts||[]) await renderPost(p); nextCursor = d.nextCursor || null;        for(const p of d.posts||[]) await renderPost(p); nextCursor = d.nextCursor || null;

        document.getElementById('btnMore').style.display = nextCursor ? 'inline-flex' : 'none';        document.getElementById('btnMore').style.display = nextCursor ? 'inline-flex' : 'none';

      } finally { loading=false; }      } finally { loading=false; }

    }    }



    document.getElementById('logoutBtnTop')?.addEventListener('click', ()=>{    document.getElementById('logoutBtnTop')?.addEventListener('click', ()=>{

      localStorage.removeItem('token'); localStorage.removeItem('user'); location.replace('index.html');      localStorage.removeItem('token'); localStorage.removeItem('user'); location.replace('index.html');

    });    });



    (async ()=>{ await loadMe(); await loadOthers(); await loadFeed(true); })();    (async ()=>{ await loadMe(); await loadOthers(); await loadFeed(true); })();

    document.getElementById('btnMore').onclick = ()=> loadFeed();    document.getElementById('btnMore').onclick = ()=> loadFeed();

  </script>  </script>

</body></body>

</html></html>


  <!-- Pre-aplica el tema para evitar FOUC -->
  <script>
    (function(){
      var saved = localStorage.getItem('theme');
      if(!saved){ saved = matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'; }
      document.documentElement.setAttribute('data-theme', saved);
    })();
  </script>

  <style>
    /* ====== LIGHT TOKENS (Recroot-like) ====== */
    :root{
      --bg:#f5f3ff; --bg2:#efeaff; --panel:#ffffff; --card:#ffffff;
      --line:rgba(16,24,40,.08);
      --text:#151826; --muted:#6b7280;
      --primary:#7c5cfc; --primary2:#a855f7; --accent:#22d3ee;
      --ring:rgba(124,92,252,.28);
      --shadow:0 12px 28px rgba(2,6,23,.08);
      --r:18px; --r2:22px;
    }

    /* ====== DARK TOKENS (Neo Purple) ====== */
    [data-theme="dark"]{
      --bg:#0a0b14; --bg2:#0d1022; --panel:#0f1324; --card:#11162b;
      --line:rgba(255,255,255,.08);
      --text:#e7e9f3; --muted:#9aa3b2;
      --primary:#8b5cf6; --primary2:#d946ef; --accent:#22d3ee;
      --ring:rgba(139,92,246,.25);
      --shadow:0 12px 28px rgba(0,0,0,.45);
    }

    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:'Plus Jakarta Sans',system-ui,Segoe UI,Roboto,Arial}

    /* Glow background (light sutil, dark intenso) */
    body::before,body::after{content:"";position:fixed;inset:auto;pointer-events:none;z-index:-1}
    body::before{top:-15%;left:-10%;width:65vw;height:55vh;filter:blur(90px);
      background:radial-gradient(50% 50% at 50% 50%, rgba(124,92,252,.28) 0%, rgba(124,92,252,0) 65%),
                 radial-gradient(50% 50% at 20% 30%, rgba(168,85,247,.18) 0%, rgba(168,85,247,0) 70%)}
    body::after{right:-10%;top:10%;width:55vw;height:50vh;filter:blur(90px);
      background:radial-gradient(50% 50% at 50% 50%, rgba(34,211,238,.18) 0%, rgba(34,211,238,0) 65%),
                 radial-gradient(50% 50% at 70% 30%, rgba(168,85,247,.12) 0%, rgba(168,85,247,0) 70%)}
    [data-theme="dark"] body::before,[data-theme="dark"] body::after{display:none}
    [data-theme="dark"] body{background:var(--bg)}
    [data-theme="dark"] body::before{content:"";display:block;position:fixed;top:-20%;left:-10%;width:60vw;height:60vh;filter:blur(70px);z-index:-1;
      background:radial-gradient(50% 50% at 50% 50%, rgba(139,92,246,.65) 0%, rgba(139,92,246,0) 65%),
                 radial-gradient(50% 50% at 20% 30%, rgba(217,70,239,.45) 0%, rgba(217,70,239,0) 70%)}
    [data-theme="dark"] body::after{content:"";display:block;position:fixed;right:-10%;top:10%;width:55vw;height:55vh;filter:blur(80px);z-index:-1;
      background:radial-gradient(50% 50% at 50% 50%, rgba(34,211,238,.35) 0%, rgba(34,211,238,0) 65%),
                 radial-gradient(50% 50% at 70% 30%, rgba(217,70,239,.25) 0%, rgba(217,70,239,0) 70%)}

    /* Topbar */
    .topbar{position:sticky;top:0;z-index:50;background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7));backdrop-filter: blur(10px);border-bottom:1px solid var(--line)}
    [data-theme="dark"] .topbar{background:linear-gradient(180deg, rgba(10,11,20,.92), rgba(10,11,20,.65))}
    .topbar-inner{max-width:1200px;margin:0 auto;padding:14px 24px;display:flex;align-items:center;gap:16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .brand::before{content:"";width:28px;height:28px;border-radius:9px;background:linear-gradient(135deg,var(--primary),var(--primary2));box-shadow:0 0 0 6px rgba(124,92,252,.12),0 10px 25px rgba(124,92,252,.25)}

    /* Buttons */
    .btn{appearance:none;border:1px solid var(--line);background:var(--panel);color:var(--text);padding:10px 16px;border-radius:999px;font-weight:700;cursor:pointer;transition:.15s ease}
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn.primary{background:linear-gradient(90deg,var(--primary),var(--primary2));border-color:transparent;color:#fff;box-shadow:0 8px 18px rgba(124,92,252,.28)}
    .btn.ghost{background:transparent}
    .btn.small{padding:8px 12px;font-size:.92rem}
    .btn.danger{background:#fee2e2;border-color:#fecaca;color:#7f1d1d}
    [data-theme="dark"] .btn.danger{background:#3b1d2a;border-color:#6b233a;color:#fce7f3}

    /* Layout */
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    .layout{display:grid;grid-template-columns:240px 1fr 320px;gap:22px}
    @media (max-width:1080px){ .layout{grid-template-columns:1fr;} .sidebar{order:3} .aside{order:2} }

    /* Surfaces */
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow)}

    /* Sidebar nav */
    .nav{display:grid;gap:8px;padding:12px}
    .nav-item{display:flex;gap:10px;align-items:center;padding:10px 12px;border-radius:12px;color:var(--text);text-decoration:none;border:1px solid transparent}
    .nav-item.active, .nav-item:hover{background:rgba(124,92,252,.10);border-color:rgba(124,92,252,.35)}
    .nav-ico{width:20px;height:20px;display:inline-flex;margin-right:6px;align-items:center;justify-content:center}
    .nav-ico svg{width:20px;height:20px;stroke:currentColor;fill:none;stroke-width:2}
    .nav-item.active .nav-ico svg{stroke:var(--primary)}

    /* Composer */
    .composer{padding:16px;display:grid;gap:12px}
    .cmp-row{display:flex;gap:12px}
    .cmp-avatar{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--primary2))}
    .cmp-input{flex:1;min-height:84px;background:#f6f7fb;border:1px solid var(--line);border-radius:14px;color:var(--text);padding:12px;outline:none}
    [data-theme="dark"] .cmp-input{background:#0b0f1d}
    .cmp-input:focus{box-shadow:0 0 0 3px var(--ring)}
    .cmp-preview{display:flex;gap:10px;align-items:center}
    .cmp-preview img{max-height:180px;border-radius:12px;border:1px solid var(--line)}
    .cmp-tools{display:flex;align-items:center;gap:8px}
    .spacer{flex:1}
    .cmp-msg{font-size:.92rem;color:var(--muted)}

    /* Feed */
    .feed{display:grid;gap:16px}
    .post-card{overflow:hidden;background:var(--card);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow)}
    .post-head{display:flex;align-items:center;gap:12px;padding:14px 16px;border-bottom:1px solid var(--line)}
    .post-ava{width:40px;height:40px;border-radius:50%;object-fit:cover;background:linear-gradient(135deg,var(--primary),var(--primary2))}
    .post-user{display:grid;line-height:1.1}
    .post-userid{color:var(--muted);font-size:.9rem}
    .post-media{position:relative;background:#f6f7fb}
    [data-theme="dark"] .post-media{background:#0b0f1d}
    .post-media img{display:block;width:100%;height:auto;object-fit:cover}
    .post-media.ratio-square img{aspect-ratio:1/1}
    .post-media.ratio-portrait img{aspect-ratio:4/5}
    .post-media.ratio-landscape img{aspect-ratio:16/9}
    .post-actions{display:flex;gap:10px;align-items:center;padding:12px 14px;border-top:1px solid var(--line)}
    .btn-icon{display:inline-flex;align-items:center;justify-content:center;width:44px;height:40px;border-radius:999px;border:1px solid var(--line);background:var(--panel);color:var(--text);cursor:pointer}
    .btn-icon i,.btn-icon svg{width:22px;height:22px}
    .btn-icon svg{stroke:currentColor;fill:none;stroke-width:2}
    .btn-icon[aria-pressed="true"]{background:linear-gradient(90deg,var(--primary),var(--primary2));border-color:transparent;color:#fff}
    .post-counts{color:var(--muted)}
    .post-caption{padding:0 14px 14px;color:var(--text)}

    /* People */
    .people-list{display:grid;gap:10px}
    .person-row{display:flex;gap:12px;align-items:center;border:1px solid var(--line);border-radius:14px;padding:10px;background:var(--panel)}
    .p-avatar img{width:36px;height:36px;border-radius:50%;object-fit:cover}
    .p-info{min-width:0}
    .p-name{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .p-user{color:var(--muted);font-size:.9rem}
    .p-actions{margin-left:auto;display:flex;gap:8px}

    /* Lightbox */
    .lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:100}
    .lightbox[aria-hidden="false"]{display:flex}
    .lb-content{display:grid;grid-template-columns:min(60vw,720px) 360px;gap:0;background:var(--card);border:1px solid var(--line);border-radius:20px;box-shadow:var(--shadow)}
    @media (max-width:1080px){ .lb-content{grid-template-columns:1fr} }
    .lb-close{position:absolute;right:12px;top:12px}
    .lb-media{background:#000;border-top-left-radius:20px;border-bottom-left-radius:20px;overflow:hidden}
    .lb-media img{display:block;width:100%;height:auto}
    .lb-side{display:grid;grid-template-rows:auto 1fr auto}
    .lb-head{display:flex;gap:10px;align-items:center;padding:12px 14px;border-bottom:1px solid var(--line)}
    .lb-ava{width:36px;height:36px;border-radius:50%}
    .lb-body{padding:12px 14px;display:grid;gap:8px;max-height:50vh;overflow:auto}
    .lb-cmt{display:grid;grid-template-columns:auto 1fr auto;gap:8px;align-items:center}
    .lb-cmt .nm{font-weight:700}
    .lb-cmt .dt{color:var(--muted);font-size:.85rem}
    .lb-input{display:flex;gap:8px;padding:12px 14px;border-top:1px solid var(--line)}
    .lb-input input{flex:1;background:#f6f7fb;border:1px solid var(--line);border-radius:12px;color:var(--text);padding:10px}
    [data-theme="dark"] .lb-input input{background:#0b0f1d}
  </style>
</head>
<body>
  <!-- Topbar -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">DACEM</div>
      <div style="margin-left:auto" class="topbar-actions">
        <button id="themeToggle" class="btn ghost small" title="Cambiar tema">🌙 Modo oscuro</button>
        <button id="logoutBtnTop" class="btn danger small">Cerrar sesión</button>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div class="layout">
      <!-- Sidebar -->
      <aside class="sidebar card">
        <nav class="nav">
          <a class="nav-item active" href="user.html">
            <i class="nav-ico" data-lucide="home"></i> Inicio
          </a>
          <a class="nav-item" href="profile.html">
            <i class="nav-ico" data-lucide="user-2"></i> Mi perfil
          </a>
        </nav>
      </aside>

      <!-- Centro -->
      <main class="main">
        <!-- Composer -->
        <section class="card composer" id="composer">
          <div class="cmp-row">
            <img id="cmpAvatar" class="cmp-avatar" alt="yo">
            <textarea id="cmpText" class="cmp-input" rows="2" placeholder="¿Qué estás pensando? (opcional)"></textarea>
          </div>
          <div id="cmpPreview" class="cmp-preview" style="display:none">
            <img id="cmpPreviewImg" alt="preview">
            <button id="cmpRemoveImg" class="btn ghost small">Quitar</button>
          </div>
          <div class="cmp-tools">
            <input id="cmpFile" type="file" accept="image/*" hidden>
            <button id="cmpPick" class="btn ghost small">📷 Imagen</button>
            <div class="spacer"></div>
            <button id="cmpPost" class="btn primary">Publicar</button>
          </div>
          <div class="cmp-msg" id="cmpMsg"></div>
        </section>

        <!-- Feed -->
        <section class="feed" id="feed"></section>
        <div class="card" style="text-align:center;padding:14px">
          <button id="btnMore" class="btn">Cargar más</button>
        </div>
      </main>

      <!-- Aside: Personas -->
      <aside class="aside">
        <div class="card" style="padding:14px">
          <h3 style="margin:0 0 12px">Personas</h3>
          <div id="peopleList" class="people-list"></div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Lightbox Post -->
  <div class="lightbox" id="lightbox" aria-hidden="true">
    <div class="lb-content" role="dialog" aria-modal="true" aria-label="Publicación">
      <button class="btn ghost small lb-close" id="lbClose">✕</button>
      <div class="lb-media"><img id="lbImg" alt=""></div>
      <aside class="lb-side">
        <header class="lb-head">
          <img id="lbAva" class="lb-ava" alt="">
          <div>
            <div id="lbName" style="font-weight:700"></div>
            <div id="lbUser" class="muted" style="font-size:12px"></div>
          </div>
        </header>
        <div class="lb-body" id="lbComments"></div>
        <div class="lb-input">
          <input id="lbInp" placeholder="Añade un comentario…">
          <button id="lbSend" class="btn">Publicar</button>
        </div>
      </aside>
    </div>
  </div>

  <!-- ===== JS ===== -->
  <script>
    // Toggle tema
    const themeBtn = document.getElementById('themeToggle');
    function applyTheme(t){
      document.documentElement.setAttribute('data-theme', t);
      localStorage.setItem('theme', t);
      if(themeBtn) themeBtn.textContent = t==='dark' ? '☀️ Modo claro' : '🌙 Modo oscuro';
      if (window.lucide) lucide.createIcons();
    }
    themeBtn?.addEventListener('click', ()=>{
      const current = document.documentElement.getAttribute('data-theme')==='dark' ? 'dark' : 'light';
      applyTheme(current==='dark' ? 'light' : 'dark');
    });
    (function(){ const t=document.documentElement.getAttribute('data-theme'); if(themeBtn) themeBtn.textContent = t==='dark' ? '☀️ Modo claro' : '🌙 Modo oscuro'; })();

    // ===== Helpers / API =====
    const API = (p)=>`${location.origin}/api${p}`;
    const token = localStorage.getItem('token');
    if(!token){ location.replace('index.html'); }

    const H  = { 'Authorization':`Bearer ${token}` };
    const $  = s => document.querySelector(s);

    function displayName(u){ return u?.name || `${u?.firstName||''} ${u?.lastName||''}`.trim() || (u?.nickname || 'Usuario'); }
    function abs(url){ return url?.startsWith('http') ? url : `${location.origin}${url?.startsWith('/')?url:'/'+url}`; }
    function resolveAvatar(u){
      if(u?.avatar) return abs(u.avatar);
      const seed = encodeURIComponent(displayName(u) || u?.nickname || 'U');
      return `https://api.dicebear.com/8.x/initials/svg?seed=${seed}&radius=50&scale=110&fontWeight=700`;
    }
    function timeAgo(iso){ try{ const d=new Date(iso); const s=(Date.now()-d)/1000; if(s<60) return 'ahora'; if(s<3600) return Math.floor(s/60)+' min'; if(s<86400) return Math.floor(s/3600)+' h'; return Math.floor(s/86400)+' d'; }catch{ return ''; } }

    async function toggleFollow(id, isFollowing){
      try{ const r = await fetch(API(`/follow/toggle/${id}`), { method:'POST', headers:H }); if (r.status !== 404){ const d = await r.json(); return !!d.ok; } }
      catch{}
      if (!isFollowing){ const r = await fetch(API(`/follow/${id}`), { method:'POST', headers:H }); const d = await r.json(); return !!d.ok; }
      else { const r = await fetch(API(`/follow/${id}`), { method:'DELETE', headers:H }); const d = await r.json(); return !!d.ok; }
    }
    function personRow(u){
      const el = document.createElement('div');
      el.className = 'person-row';
      el.innerHTML = `
        <div class="p-avatar"><img src="${resolveAvatar(u)}" alt=""></div>
        <div class="p-info">
          <div class="p-name" title="${displayName(u)}">${displayName(u)}</div>
          <div class="p-user" title="@${u.nickname || 'usuario'}">@${u.nickname || 'usuario'}</div>
        </div>
        <div class="p-actions">
          <a class="btn ghost small" href="profile.html?id=${u._id}">Ver perfil</a>
          <button class="btn small">${u.isFollowing?'Dejar de seguir':'Seguir'}</button>
        </div>`;
      const btn = el.querySelector('button');
      btn.onclick = async () => {
        btn.disabled = true;
        const ok = await toggleFollow(u._id, !!u.isFollowing);
        if (ok){ u.isFollowing=!u.isFollowing; btn.textContent = u.isFollowing?'Dejar de seguir':'Seguir'; }
        btn.disabled = false;
      };
      return el;
    }
    async function loadOthers(){
      const list = document.querySelector('#peopleList'); if (!list) return;
      list.innerHTML = '';
      const r = await fetch(API('/user/others'), { headers:H });
      const d = await r.json();
      if(!d.ok || !d.users?.length){ list.innerHTML = '<div class="muted">No hay sugerencias por ahora.</div>'; return; }
      d.users.forEach(u => list.appendChild(personRow(u)));
    }

    let me = null; const userCache = new Map();
    async function loadMe(){
      const r = await fetch(API('/user/me'), { headers:H });
      const d = await r.json(); if(!d.ok){ localStorage.clear(); return location.replace('index.html'); }
      me = d.user; userCache.set(me._id, me);
      document.querySelector('#cmpAvatar').src = resolveAvatar(me);
    }

    const cmp = { fileEl: document.querySelector('#cmpFile'), pick: document.querySelector('#cmpPick'), imgBox: document.querySelector('#cmpPreview'), img: document.querySelector('#cmpPreviewImg'), rm: document.querySelector('#cmpRemoveImg'), txt: document.querySelector('#cmpText'), post: document.querySelector('#cmpPost'), msg: document.querySelector('#cmpMsg') };
    let selectedFile = null;
    cmp.pick.onclick = ()=> cmp.fileEl.click();
    cmp.fileEl.onchange = e=>{
      const f = e.target.files?.[0];
      if(!f){ selectedFile=null; cmp.imgBox.style.display='none'; return; }
      selectedFile = f; cmp.img.src = URL.createObjectURL(f); cmp.imgBox.style.display='flex';
    };
    cmp.rm.onclick = ()=>{ selectedFile=null; cmp.fileEl.value=''; cmp.imgBox.style.display='none'; cmp.img.removeAttribute('src'); };

    async function publish(){
      cmp.post.disabled = true; cmp.msg.textContent = 'Publicando...';
      try{
        const fd = new FormData();
        if (selectedFile) fd.append('image', selectedFile);
        if (cmp.txt.value.trim()) fd.append('caption', cmp.txt.value.trim());
        const r = await fetch(API('/posts'), { method:'POST', headers:H, body:fd });
        const d = await r.json();
        if(!d.ok) throw new Error(d.message||'Error');
        prependPost(d.post);
        cmp.msg.textContent = '¡Publicado!'; cmp.txt.value=''; cmp.rm.click();
        setTimeout(()=>cmp.msg.textContent='', 1200);
      }catch{ cmp.msg.textContent = 'No se pudo publicar'; }
      finally{ cmp.post.disabled=false; }
    }
    cmp.post.onclick = publish;

    const feedEl = document.querySelector('#feed');
    let nextCursor = null, loading = false;

    function iconComment(){ return '<i data-lucide="message-circle"></i>'; }
    function iconLike(){ return '<i data-lucide="heart"></i>'; }
    function ratioClass(w,h){ const r=w/h; if(r<0.95) return 'ratio-portrait'; if(r>1.6) return 'ratio-landscape'; return 'ratio-square'; }

    async function getUserCached(id){
      if (userCache.has(id)) return userCache.get(id);
      const r = await fetch(API(`/user/${id}/public`), { headers:H });
      const d = await r.json(); if (d.ok){ userCache.set(id,d.user); return d.user; }
      return { nickname:'usuario', firstName:'', lastName:'', avatar:null };
    }

    // Lightbox
    const lb = document.getElementById('lightbox'), lbClose = document.getElementById('lbClose');
    const lbImg = document.getElementById('lbImg'), lbAva = document.getElementById('lbAva');
    const lbName = document.getElementById('lbName'), lbUser = document.getElementById('lbUser');
    const lbBody = document.getElementById('lbComments'), lbInp = document.getElementById('lbInp'), lbSend = document.getElementById('lbSend');

    async function listPostComments(postId){
      const r = await fetch(API(`/posts/${postId}/comments?limit=100`), { headers:H });
      const d = await r.json(); return d.ok ? d.comments : [];
    }
    async function addPostComment(postId, text){
      const r = await fetch(API(`/posts/${postId}/comments`), { method:'POST', headers:{...H,'Content-Type':'application/json'}, body:JSON.stringify({ text }) });
      const d = await r.json(); return d.ok ? d.comment : null;
    }
    async function renderComments(list){
      lbBody.innerHTML='';
      for (const c of list) if (!userCache.has(c.userId)) await getUserCached(c.userId);
      list.forEach(c=>{
        const u=userCache.get(c.userId), nm=displayName(u)||'usuario';
        const row=document.createElement('div'); row.className='lb-cmt';
        row.innerHTML=`<span class="nm">${nm}</span>${c.text}<span class="dt">${timeAgo(c.createdAt)}</span>`;
        lbBody.appendChild(row);
      });
      lbBody.scrollTop = lbBody.scrollHeight;
    }
    async function openPostModal(p){
      lbImg.src = p.media.t1 || p.media.original || p.media.thumb;
      const u = await getUserCached(p.userId);
      lbAva.src = resolveAvatar(u); lbName.textContent = displayName(u); lbUser.textContent = `@${u.nickname || 'usuario'}`;
      const comments = await listPostComments(p.id); await renderComments(comments);
      lbSend.onclick = async ()=>{ const t = lbInp.value.trim(); if(!t) return;
        const c = await addPostComment(p.id, t); if(c){ lbInp.value=''; comments.push(c); await renderComments(comments); } };
      lb.setAttribute('aria-hidden','false');
    }
    function closePostModal(){ lb.setAttribute('aria-hidden','true'); lbImg.removeAttribute('src'); lbInp.value=''; lbBody.innerHTML=''; }
    lbClose.onclick = closePostModal;
    lb.addEventListener('click', (e)=>{ if(e.target===lb) closePostModal(); });
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && lb.getAttribute('aria-hidden')==='false') closePostModal(); });

    function postCard(p){
      const cls = ratioClass(p.media.width, p.media.height);
      const el = document.createElement('article'); el.className='post-card';
      const author = userCache.get(p.userId) || {};
      el.innerHTML = `
        <header class="post-head">
          <img class="post-ava" src="${resolveAvatar(author)}" alt="">
          <div class="post-user">
            <a class="post-name" href="profile.html?id=${p.userId}">${displayName(author)}</a>
            <div class="post-userid">@${author.nickname || 'usuario'}</div>
          </div>
        </header>
        <div class="post-media ${cls}"><img class="post-img" src="${p.media.thumb}" alt=""></div>
        <div class="post-actions">
          <button class="btn-icon btn-like" aria-pressed="${p.viewerLiked?'true':'false'}" title="Me gusta">${iconLike()}</button>
          <button class="btn-icon btn-comment" title="Comentar">${iconComment()}</button>
          <div class="spacer"></div>
          <div class="post-counts"><span class="likes">${p.counts?.likes||0}</span> · <span class="comments">${p.counts?.comments||0}</span></div>
        </div>
        ${p.caption ? `<div class="post-caption">${p.caption}</div>` : '' }`;

      const likeBtn = el.querySelector('.btn-like'); const likesEl = el.querySelector('.likes');
      likeBtn.onclick = async ()=>{
        const pressed = likeBtn.getAttribute('aria-pressed')==='true';
        likeBtn.setAttribute('aria-pressed',(!pressed)+'');
        likesEl.textContent=(+likesEl.textContent+(pressed?-1:1));
        try{
          const r=await fetch(API(`/posts/${p.id}/likes/toggle`), {method:'POST', headers:H});
          const d=await r.json(); if(!d.ok) throw 0;
        } catch{
          likeBtn.setAttribute('aria-pressed',pressed+'');
          likesEl.textContent=(+likesEl.textContent+(pressed?1:-1));
        }
      };

      el.querySelector('.btn-comment').onclick = ()=> openPostModal(p);
      el.querySelector('.post-img').onclick   = ()=> openPostModal(p);

      // Inicializa iconos recién insertados
      if (window.lucide) lucide.createIcons();
      return el;
    }

    async function renderPost(p){
      if(!userCache.has(p.userId)) await getUserCached(p.userId);
      feedEl.appendChild(postCard(p));
    }
    function prependPost(p){
      if(!userCache.has(p.userId)) userCache.set(p.userId, me);
      feedEl.prepend(postCard(p));
    }

    async function loadFeed(first=false){
      if (loading) return; loading=true;
      try{
        const url = new URL(API('/posts')); url.searchParams.set('limit','10');
        if (nextCursor) url.searchParams.set('cursor', nextCursor);
        const r = await fetch(url.toString(), { headers:H }); const d = await r.json(); if(!d.ok) return;
        for(const p of d.posts||[]) await renderPost(p); nextCursor = d.nextCursor || null;
        document.getElementById('btnMore').style.display = nextCursor ? 'inline-block' : 'none';
      } finally { loading=false; }
    }

    document.getElementById('logoutBtnTop')?.addEventListener('click', ()=>{
      localStorage.removeItem('token'); localStorage.removeItem('user'); location.replace('index.html');
    });

    (async ()=>{ await loadMe(); await loadOthers(); await loadFeed(true); if (window.lucide) lucide.createIcons(); })();
    document.getElementById('btnMore').onclick = ()=> loadFeed();
  </script>
</body>
</html>
